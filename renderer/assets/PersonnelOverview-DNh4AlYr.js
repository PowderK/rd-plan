import{j as e}from"./client-nyetWBf2.js";import{r as o}from"./index-DOOLV48n.js";import{s as l}from"./PersonnelOverview.module-S9DstIlR.js";const Ce=({onImportComplete:p,onClose:b})=>{const[h,x]=o.useState(!1),[u,w]=o.useState(null),[y,O]=o.useState(!1),S=async()=>{try{const a=await window.electronAPI.invoke("show-open-dialog",{title:"Excel-Datei für Personal-Import auswählen",filters:[{name:"Excel-Dateien",extensions:["xlsx","xls","csv"]},{name:"Alle Dateien",extensions:["*"]}],properties:["openFile"]});if(a.canceled||!a.filePaths?.length)return;const N=a.filePaths[0];x(!0),w(null);const D=await window.electronAPI.invoke("import-personnel-excel",N,y);w(D),x(!1),p&&p(D)}catch(a){console.error("Import-Fehler:",a),w({success:!1,imported:0,skipped:0,errors:[`Import fehlgeschlagen: ${a instanceof Error?a.message:String(a)}`]}),x(!1)}},R=async()=>{try{const a=await window.electronAPI.invoke("show-save-dialog",{title:"Personal-Daten als Excel exportieren",defaultPath:`Personal-Export-${new Date().toISOString().slice(0,10)}.xlsx`,filters:[{name:"Excel-Dateien",extensions:["xlsx"]},{name:"Alle Dateien",extensions:["*"]}]});if(a.canceled||!a.filePath)return;x(!0),await window.electronAPI.invoke("export-personnel-excel",a.filePath),x(!1),alert("Export erfolgreich abgeschlossen!")}catch(a){console.error("Export-Fehler:",a),x(!1),alert(`Export fehlgeschlagen: ${a instanceof Error?a.message:String(a)}`)}},z=async()=>{try{const a=await window.electronAPI.invoke("show-save-dialog",{title:"Excel-Vorlage erstellen",defaultPath:"Personal-Import-Vorlage.xlsx",filters:[{name:"Excel-Dateien",extensions:["xlsx"]},{name:"Alle Dateien",extensions:["*"]}]});if(a.canceled||!a.filePath)return;x(!0),await window.electronAPI.invoke("create-personnel-template",a.filePath),x(!1),alert("Vorlage erfolgreich erstellt!")}catch(a){console.error("Template-Fehler:",a),x(!1),alert(`Vorlage-Erstellung fehlgeschlagen: ${a instanceof Error?a.message:String(a)}`)}};return e.jsxs("div",{className:"excel-import-container",style:{padding:"20px",maxWidth:"600px"},children:[e.jsx("h2",{children:"Personal-Daten Excel Import/Export"}),e.jsxs("div",{className:"import-section",style:{marginBottom:"30px"},children:[e.jsx("h3",{children:"Import aus Excel"}),e.jsx("p",{children:"Importiere Personal-Daten aus einer Excel-Datei."}),e.jsx("div",{style:{marginBottom:"10px"},children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:y,onChange:a=>O(a.target.checked),disabled:h}),e.jsx("span",{style:{marginLeft:"8px"},children:"Bestehende Personal-Daten ersetzen (Vorsicht: Alle aktuellen Daten werden gelöscht!)"})]})}),e.jsx("div",{style:{marginBottom:"10px"},children:e.jsx("button",{onClick:S,disabled:h,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:h?"not-allowed":"pointer"},children:h?"Importiere...":"Excel-Datei importieren"})}),u&&e.jsxs("div",{className:"import-result",style:{padding:"10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:u.success?"#d4edda":"#f8d7da",color:u.success?"#155724":"#721c24"},children:[e.jsx("h4",{children:"Import-Ergebnis:"}),e.jsxs("p",{children:["Status: ",u.success?"Erfolgreich":"Fehlerhaft"]}),e.jsxs("p",{children:["Importiert: ",u.imported]}),e.jsxs("p",{children:["Übersprungen: ",u.skipped]}),u.errors.length>0&&e.jsxs("div",{children:[e.jsx("p",{children:"Fehler:"}),e.jsx("ul",{children:u.errors.map((a,N)=>e.jsx("li",{children:a},N))})]})]})]}),e.jsxs("div",{className:"export-section",style:{marginBottom:"30px"},children:[e.jsx("h3",{children:"Export nach Excel"}),e.jsx("p",{children:"Exportiere aktuelle Personal-Daten als Excel-Datei."}),e.jsx("button",{onClick:R,disabled:h,style:{padding:"10px 20px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:h?"not-allowed":"pointer",marginRight:"10px"},children:h?"Exportiere...":"Als Excel exportieren"})]}),e.jsxs("div",{className:"template-section",style:{marginBottom:"30px"},children:[e.jsx("h3",{children:"Excel-Vorlage"}),e.jsx("p",{children:"Erstelle eine Excel-Vorlage für den Import mit der richtigen Spaltenstruktur."}),e.jsx("button",{onClick:z,disabled:h,style:{padding:"10px 20px",backgroundColor:"#ffc107",color:"#212529",border:"none",borderRadius:"4px",cursor:h?"not-allowed":"pointer"},children:h?"Erstelle...":"Vorlage erstellen"})]}),e.jsxs("div",{className:"help-section",style:{backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"4px"},children:[e.jsx("h4",{children:"Excel-Format:"}),e.jsx("p",{children:"Die Excel-Datei sollte folgende Spalten enthalten:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte A:"})," Name (Nachname)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte B:"})," Vorname"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte C:"})," Teilzeit (ja/nein, 1/0, true/false)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte D:"})," Fahrzeugführer (ja/nein, 1/0, true/false)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte E:"})," Fahrzeugführer HLFB (ja/nein, 1/0, true/false)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte F:"})," NEF (ja/nein, 1/0, true/false)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte G:"})," ITW Maschinist (ja/nein, 1/0, true/false)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spalte H:"})," ITW Fahrzeugführer (ja/nein, 1/0, true/false)"]})]}),e.jsx("p",{children:e.jsx("em",{children:"Die erste Zeile wird als Header übersprungen."})})]}),b&&e.jsx("div",{style:{marginTop:"20px",textAlign:"right"},children:e.jsx("button",{onClick:b,style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Schließen"})})]})},Ne=()=>{const[p,b]=o.useState([]),[h,x]=o.useState([]),[u,w]=o.useState([]),[y,O]=o.useState(null),[S,R]=o.useState(null),[z,a]=o.useState(null),[N,D]=o.useState(!1),[L,A]=o.useState(null),[m,P]=o.useState(null),[B,_]=o.useState(null),[d,T]=o.useState(!1),[F,X]=o.useState(null),[H,G]=o.useState(null),[g,M]=o.useState(!1),[k,ee]=o.useState(null),[J,Z]=o.useState(null),[f,V]=o.useState(!1),[C,ne]=o.useState(null),[W,q]=o.useState(null),[te,K]=o.useState(!1),v=o.useCallback(async()=>{D(!0);const n=await window.api.getPersonnelList();b(n),D(!1)},[]),I=o.useCallback(async()=>{const n=await window.api.getAzubiList();x(n)},[]),E=o.useCallback(async()=>{const n=await window.api.getItwDoctors();w(n)},[]);o.useEffect(()=>{v(),I(),E();const n=s=>{console.log("[Renderer] personnel-updated Event empfangen"),v(),I(),E()};window.api.onPersonnelUpdated?.(n);const r=s=>{console.log("[Renderer] azubis-updated Event empfangen"),I()};window.api.onAzubisUpdated?.(r);const i=s=>{console.log("[Renderer] itw-updated Event empfangen"),E()};window.api.onItwUpdated?.(i);const t=s=>{s.data==="personnel-updated"?(console.log("[Renderer] personnel-updated via postMessage empfangen"),v()):s.data==="azubis-updated"?(console.log("[Renderer] azubis-updated via postMessage empfangen"),I()):s.data==="itw-updated"&&(console.log("[Renderer] itw-updated via postMessage empfangen"),E())};return window.addEventListener("message",t),()=>{window.api.offPersonnelUpdated?.(n),window.api.offAzubisUpdated?.(r),window.api.offItwUpdated?.(i),window.removeEventListener("message",t)}},[v,I]);const se=n=>O(n),U=(n,r,i)=>{n.preventDefault();const t=n.currentTarget.getBoundingClientRect(),c=n.clientY-t.top<t.height/2?"above":"below";A(r),P(c),_(i)},$=()=>{A(null),P(null),_(null)},le=async n=>{if(y===null||y===n)return;const r=p.findIndex(c=>c.id===y);let i=p.findIndex(c=>c.id===n);m==="below"&&(i+=1);const t=[...p],[s]=t.splice(r,1);r<i&&(i-=1),t.splice(Math.max(0,Math.min(t.length,i)),0,s),b(t),O(null),A(null),P(null),await window.api.updatePersonnelOrder(t.map(c=>c.id)),v()},ie=()=>{G(JSON.parse(JSON.stringify(p))),T(!0)},re=()=>{H&&b(H),T(!1)},ae=async()=>{try{for(const n of p){const r=H?.find(i=>i.id===n.id);(!r||JSON.stringify(r)!==JSON.stringify(n))&&await window.api.updatePerson({id:n.id,name:n.name,vorname:n.vorname,teilzeit:n.teilzeit,fahrzeugfuehrer:n.fahrzeugfuehrer,fahrzeugfuehrerHLFB:n.fahrzeugfuehrerHLFB,nef:n.nef||!1,itwMaschinist:n.itwMaschinist||!1,itwFahrzeugfuehrer:n.itwFahrzeugfuehrer||!1,sort:n.sort??0})}T(!1),G(null),v()}catch(n){console.warn("[PersonnelOverview] saveEditing Fehler",n)}},j=(n,r,i)=>{b(t=>t.map(s=>s.id===n?{...s,[r]:i}:s))},oe=n=>{X(n===F?null:n)},de=()=>{F!=null&&window.api.openConfirmDeleteWindow(F)},ce=n=>R(n),he=async n=>{if(S===null||S===n)return;const r=h.findIndex(c=>c.id===S);let i=h.findIndex(c=>c.id===n);m==="below"&&(i+=1);const t=[...h],[s]=t.splice(r,1);r<i&&(i-=1),t.splice(Math.max(0,Math.min(t.length,i)),0,s),x(t),R(null),A(null),P(null),await window.api.updateAzubiOrder(t.map(c=>c.id)),I()},ue=n=>a(n),xe=async n=>{if(z===null||z===n)return;const r=u.findIndex(c=>c.id===z);let i=u.findIndex(c=>c.id===n);m==="below"&&(i+=1);const t=[...u],[s]=t.splice(r,1);r<i&&(i-=1),t.splice(Math.max(0,Math.min(t.length,i)),0,s),w(t),a(null),A(null),P(null),await window.api.updateItwDoctorOrder(t.map(c=>c.id)),E()},pe=()=>{Z(JSON.parse(JSON.stringify(h))),M(!0)},ge=()=>{J&&x(J),M(!1)},me=async()=>{try{for(const n of h){const r=J?.find(i=>i.id===n.id);(!r||JSON.stringify(r)!==JSON.stringify(n))&&await window.api.updateAzubi({id:n.id,name:n.name,vorname:n.vorname,lehrjahr:n.lehrjahr})}M(!1),Z(null),I()}catch(n){console.warn("[PersonnelOverview] saveEditingAzubis Fehler",n)}},Y=(n,r,i)=>{x(t=>t.map(s=>s.id===n?{...s,[r]:i}:s))},fe=n=>ee(n===k?null:n),we=()=>{k!=null&&window.api.openConfirmDeleteWindow(k,"azubi")},je=()=>{q(JSON.parse(JSON.stringify(u))),V(!0)},be=()=>{W&&w(W),V(!1)},ve=async()=>{try{for(const n of u){const r=W?.find(i=>i.id===n.id);(!r||JSON.stringify(r)!==JSON.stringify(n))&&await window.api.updateItwDoctor({id:n.id,name:n.name,vorname:n.vorname})}V(!1),q(null),E()}catch(n){console.warn("[PersonnelOverview] saveEditingItw Fehler",n)}},Q=(n,r,i)=>{w(t=>t.map(s=>s.id===n?{...s,[r]:i}:s))},Ie=n=>ne(n===C?null:n),ye=()=>{C!=null&&window.api.openConfirmDeleteWindow(C,"itw")},ke=n=>{console.log("Excel-Import abgeschlossen:",n),v(),n.success&&alert(`Import erfolgreich! ${n.imported} Personen importiert, ${n.skipped} übersprungen.`)};return e.jsxs("div",{style:{padding:24},children:[te&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{backgroundColor:"white",borderRadius:"8px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0,0,0,0.3)"},children:e.jsx(Ce,{onImportComplete:ke,onClose:()=>K(!1)})})}),N?e.jsx("div",{children:"Lade Daten..."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:l.table,children:[e.jsx("thead",{children:e.jsxs("tr",{className:l.thead,children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Vorname"}),e.jsx("th",{className:l.narrow,children:"Teilzeit (%)"}),e.jsx("th",{className:l.checkboxCell,children:"FzF"}),e.jsx("th",{className:l.checkboxCell,children:"FzF HLF-B"}),e.jsx("th",{className:l.checkboxCell,children:"NEF"}),e.jsx("th",{className:l.checkboxCell,children:"ITW Ma."}),e.jsx("th",{className:l.checkboxCell,children:"ITW FzF"}),e.jsx("th",{style:{width:60},className:l.center,children:"#"})]})}),e.jsx("tbody",{className:l.tbody,children:p.map(n=>{const r=n.id===F,i=B==="person"&&L===n.id,t=[l.row,r?l.selected:"",i&&m==="above"?l.dropAbove:"",i&&m==="below"?l.dropBelow:""].filter(Boolean).join(" ");return e.jsxs("tr",{draggable:!d,onDragStart:()=>!d&&se(n.id),onDragOver:s=>!d&&U(s,n.id,"person"),onDragLeave:()=>!d&&$(),onDrop:()=>!d&&le(n.id),onClick:()=>oe(n.id),className:t,style:{cursor:d?"default":"move"},children:[e.jsx("td",{children:d?e.jsx("input",{value:n.name,onChange:s=>j(n.id,"name",s.target.value)}):n.name}),e.jsx("td",{children:d?e.jsx("input",{value:n.vorname,onChange:s=>j(n.id,"vorname",s.target.value)}):n.vorname}),e.jsx("td",{children:d?e.jsx("input",{type:"number",className:l.narrow,value:n.teilzeit,onChange:s=>j(n.id,"teilzeit",Number(s.target.value))}):n.teilzeit}),e.jsx("td",{className:l.checkboxCell,children:e.jsx("input",{type:"checkbox",disabled:!d,checked:!!n.fahrzeugfuehrer,onChange:s=>d&&j(n.id,"fahrzeugfuehrer",s.target.checked)})}),e.jsx("td",{className:l.checkboxCell,children:e.jsx("input",{type:"checkbox",disabled:!d,checked:!!n.fahrzeugfuehrerHLFB,onChange:s=>d&&j(n.id,"fahrzeugfuehrerHLFB",s.target.checked)})}),e.jsx("td",{className:l.checkboxCell,children:e.jsx("input",{type:"checkbox",disabled:!d,checked:!!n.nef,onChange:s=>d&&j(n.id,"nef",s.target.checked)})}),e.jsx("td",{className:l.checkboxCell,children:e.jsx("input",{type:"checkbox",disabled:!d,checked:!!n.itwMaschinist,onChange:s=>d&&j(n.id,"itwMaschinist",s.target.checked)})}),e.jsx("td",{className:l.checkboxCell,children:e.jsx("input",{type:"checkbox",disabled:!d,checked:!!n.itwFahrzeugfuehrer,onChange:s=>d&&j(n.id,"itwFahrzeugfuehrer",s.target.checked)})}),e.jsx("td",{className:l.center,children:r?"✓":""})]},n.id)})})]}),d?e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:ae,children:"Speichern"}),e.jsx("button",{onClick:re,children:"Abbrechen"})]}):e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:()=>window.api.openAddPersonWindow(),children:"Hinzufügen"}),e.jsx("button",{onClick:ie,disabled:p.length===0,children:"Ändern"}),e.jsx("button",{onClick:de,disabled:F==null,children:"Löschen"}),e.jsx("button",{onClick:()=>K(!0),style:{marginLeft:16,backgroundColor:"#28a745",color:"white"},children:"Excel Import/Export"})]})]}),e.jsxs("div",{style:{marginTop:32},children:[e.jsx("h3",{children:"Azubis"}),e.jsxs("table",{className:l.table,children:[e.jsx("thead",{children:e.jsxs("tr",{className:l.thead,children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Vorname"}),e.jsx("th",{className:l.narrow,children:"Lehrjahr"}),e.jsx("th",{className:l.center,style:{width:60},children:"#"})]})}),e.jsx("tbody",{className:l.tbody,children:h.map(n=>{const r=B==="azubi"&&L===n.id,i=[l.row,k===n.id?l.selected:"",r&&m==="above"?l.dropAbove:"",r&&m==="below"?l.dropBelow:""].filter(Boolean).join(" ");return e.jsxs("tr",{draggable:!g,onDragStart:()=>!g&&ce(n.id),onDragOver:t=>!g&&U(t,n.id,"azubi"),onDragLeave:()=>!g&&$(),onDrop:()=>!g&&he(n.id),onClick:()=>fe(n.id),className:i,style:{cursor:g?"default":"move"},children:[e.jsx("td",{children:g?e.jsx("input",{value:n.name,onChange:t=>Y(n.id,"name",t.target.value)}):n.name}),e.jsx("td",{children:g?e.jsx("input",{value:n.vorname,onChange:t=>Y(n.id,"vorname",t.target.value)}):n.vorname}),e.jsx("td",{children:g?e.jsx("input",{type:"number",className:l.narrow,value:n.lehrjahr,onChange:t=>Y(n.id,"lehrjahr",Number(t.target.value))}):n.lehrjahr}),e.jsx("td",{className:l.center,children:k===n.id?"✓":""})]},n.id)})})]}),g?e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:me,children:"Speichern"}),e.jsx("button",{onClick:ge,children:"Abbrechen"})]}):e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:()=>window.api.openAddAzubiWindow(),children:"Hinzufügen"}),e.jsx("button",{onClick:pe,disabled:h.length===0,children:"Ändern"}),e.jsx("button",{onClick:we,disabled:k==null,children:"Löschen"})]})]}),e.jsxs("div",{style:{marginTop:32},children:[e.jsx("h3",{children:"ITW Ärzte"}),e.jsxs("table",{className:l.table,children:[e.jsx("thead",{children:e.jsxs("tr",{className:l.thead,children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Vorname"}),e.jsx("th",{className:l.center,style:{width:60},children:"#"})]})}),e.jsx("tbody",{className:l.tbody,children:u.map(n=>{const r=B==="itw"&&L===n.id,i=[l.row,C===n.id?l.selected:"",r&&m==="above"?l.dropAbove:"",r&&m==="below"?l.dropBelow:""].filter(Boolean).join(" ");return e.jsxs("tr",{draggable:!f,onDragStart:()=>!f&&ue(n.id),onDragOver:t=>!f&&U(t,n.id,"itw"),onDragLeave:()=>!f&&$(),onDrop:()=>!f&&xe(n.id),onClick:()=>Ie(n.id),className:i,style:{cursor:f?"default":"move"},children:[e.jsx("td",{children:f?e.jsx("input",{value:n.name,onChange:t=>Q(n.id,"name",t.target.value)}):n.name}),e.jsx("td",{children:f?e.jsx("input",{value:n.vorname,onChange:t=>Q(n.id,"vorname",t.target.value)}):n.vorname}),e.jsx("td",{className:l.center,children:C===n.id?"✓":""})]},n.id)})})]}),f?e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:ve,children:"Speichern"}),e.jsx("button",{onClick:be,children:"Abbrechen"})]}):e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:()=>window.api.openAddItwWindow(),children:"Hinzufügen"}),e.jsx("button",{onClick:je,disabled:u.length===0,children:"Ändern"}),e.jsx("button",{onClick:ye,disabled:C==null,children:"Löschen"})]})]})]})};export{Ne as P};
