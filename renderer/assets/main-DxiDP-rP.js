import{j as t,c as oe}from"./client-nyetWBf2.js";import{R as te,r as p}from"./index-DOOLV48n.js";import{D as ie}from"./DutyRoster-BewrOOoq.js";import{P as re}from"./PersonnelOverview-DNh4AlYr.js";import{V as ce}from"./Vehicles-ByNge7rw.js";import{S as le}from"./SettingsMenu-PmoXDcmk.js";import"./PersonnelOverview.module-S9DstIlR.js";const de=({rescueStation:l,department:S,year:w})=>{const[A,r]=te.useState(!1),u=()=>{const P=document.documentElement,I=P.getAttribute("data-theme")!=="dark";I?P.setAttribute("data-theme","dark"):P.removeAttribute("data-theme"),r(I);try{localStorage.setItem("rdplan.theme",I?"dark":"light")}catch{}};return te.useEffect(()=>{try{localStorage.getItem("rdplan.theme")==="dark"?(document.documentElement.setAttribute("data-theme","dark"),r(!0)):(document.documentElement.removeAttribute("data-theme"),r(!1))}catch{}},[]),t.jsxs("header",{style:{position:"sticky",top:0,zIndex:10},children:[null,t.jsx("div",{style:{position:"relative",width:"min(1400px, 98vw)",margin:"0 auto",height:"clamp(56px, 6.5vw, 90px)",backgroundImage:`url(${new URL(""+new URL("Header-CW37cUF7.png",import.meta.url).href,import.meta.url).href})`,backgroundRepeat:"no-repeat",backgroundSize:"100% 100%",backgroundPosition:"left top"},children:t.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"clamp(6px, 1.2vw, 14px) clamp(20px, 3.5vw, 48px) clamp(6px, 1.2vw, 14px) clamp(56px, 7vw, 160px)"},children:[t.jsxs("div",{style:{color:"#fff",fontSize:"clamp(16px, 2.4vw, 24px)",fontWeight:800,letterSpacing:"0.3px",textShadow:"0 1px 2px rgba(0,0,0,0.35)",marginLeft:"clamp(8px, 1vw, 16px)"},children:["Feuer- und Rettungswache ",String(l)," ",S,". Abteilung ",w]}),t.jsx("div",{children:t.jsx("button",{onClick:u,title:A?"Light Mode umschalten":"Dark Mode umschalten",style:{padding:"8px 12px",color:"#fff",background:"transparent",border:"1px solid rgba(255,255,255,0.35)",borderRadius:10,backdropFilter:"saturate(120%) brightness(105%)"},children:A?t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("circle",{cx:"12",cy:"12",r:"4",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M12 2v3M12 19v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M2 12h3M19 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}):t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z",stroke:"currentColor",strokeWidth:"2",fill:"none"})})})})]})})]})},ue=()=>t.jsx("footer",{style:{textAlign:"center",padding:"10px",borderTop:"1px solid #ccc"}}),Kt={display:"flex",alignItems:"center",gap:8,width:"100%",padding:"8px 10px",border:"none",background:"transparent",cursor:"pointer",borderRadius:6};function $t(l){window.dispatchEvent(new CustomEvent("navigate",{detail:{view:l}}))}const fe=({active:l})=>{const[S,w]=p.useState(!1),A=({path:P,viewBox:I="0 0 24 24"})=>t.jsx("svg",{"aria-hidden":!0,width:18,height:18,viewBox:I,fill:"none",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round",style:{minWidth:18},children:t.jsx("path",{d:P})}),r={einteilung:"M3 7h10M3 12h14M3 17h8",dienstplan:"M8 3v3M16 3v3M3 9h18M5 12h4m-4 4h6m4-4h4m-4 4h4",werte:"M4 19V9m6 10V5m6 14v-7",personal:"M16 14c2.21 0 4 1.79 4 4v2H4v-2c0-2.21 1.79-4 4-4h8Zm-4-2a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z",fahrzeuge:"M3 13l2-5a2 2 0 0 1 2-1h8a2 2 0 0 1 2 1l2 5v5h-2a2 2 0 0 1-2-2H7a2 2 0 0 1-2 2H3v-5Zm4-1h10",einstellungen:"M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm8 4l-1.2-.7.2-1.4-1.4-.8-.8-1.4-1.4.2L14 6l-2-1-2 1-1.4-.2-.8 1.4-1.4.8.2 1.4L4 12l1.2.7-.2 1.4 1.4.8.8 1.4 1.4-.2 2 1 2-1 1.4.2.8-1.4 1.4-.8-.2-1.4L20 12Z",power:"M12 2v10m6.36-6.36a9 9 0 1 1-12.72 0"},u=({keyName:P,icon:I,label:W,onClick:Z})=>t.jsxs("button",{onClick:Z,title:S?W:void 0,style:{...Kt,background:l===P?"var(--hover)":"transparent",color:l===P?"var(--text)":void 0},children:[I,!S&&t.jsx("span",{children:W})]});return t.jsxs("aside",{style:{width:S?56:200,transition:"width 0.15s",borderRight:"1px solid var(--line)",background:"var(--bg)",boxSizing:"border-box",padding:8},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,overflow:"auto",paddingBottom:64},children:[t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("button",{onClick:()=>w(P=>!P),title:S?"Aufklappen":"Einklappen",style:{...Kt,padding:6,width:S?40:32},children:t.jsx("span",{"aria-hidden":!0,children:S?"›":"‹"})})}),t.jsxs("nav",{style:{display:"flex",flexDirection:"column",gap:4},children:[t.jsx(u,{keyName:"einteilung",icon:t.jsx(A,{path:r.einteilung}),label:"Einteilung",onClick:()=>$t("einteilung")}),t.jsx(u,{keyName:"dienstplan",icon:t.jsx(A,{path:r.dienstplan}),label:"Dienstplan",onClick:()=>$t("dienstplan")}),t.jsx(u,{keyName:"werte",icon:t.jsx(A,{path:r.werte}),label:"Werte",onClick:()=>$t("werte")}),t.jsx(u,{keyName:"personal",icon:t.jsx(A,{path:r.personal}),label:"Personal",onClick:()=>$t("personal")}),t.jsx(u,{keyName:"fahrzeuge",icon:t.jsx(A,{path:r.fahrzeuge}),label:"Fahrzeuge",onClick:()=>$t("fahrzeuge")})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.jsx(u,{keyName:"einstellungen",icon:t.jsx(A,{path:r.einstellungen}),label:"Einstellungen",onClick:()=>$t("einstellungen")})})]}),t.jsx("div",{style:{position:"fixed",left:8,bottom:8,width:(S?56:200)-16},children:t.jsxs("button",{onClick:()=>window.api?.quitApp?.(),style:{...Kt,color:"#991b1b",width:"100%"},title:S?"Beenden":void 0,children:[t.jsx(A,{path:r.power}),!S&&t.jsx("span",{children:"Beenden"})]})})]})},qt=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function pe(){const[l,S]=p.useState(new Date().getFullYear());return p.useEffect(()=>{(async()=>{try{const w=await window.api.getSetting("year");S(Number(w||new Date().getFullYear()))}catch{}})()},[]),l}function he(l){const[S,w]=p.useState([]);return p.useEffect(()=>{(async()=>{try{const A=await window.api.getDutyRoster(l);w(Array.isArray(A)?A:[])}catch{w([])}})()},[l]),S}function me(){const[l,S]=p.useState([]);return p.useEffect(()=>{(async()=>{try{const w=await window.api.getPersonnelList?.();S(Array.isArray(w)?w:[])}catch{S([])}})()},[]),l}function ge(){const[l,S]=p.useState([]);return p.useEffect(()=>{(async()=>{try{const w=await window.api.getAzubiList?.();S(Array.isArray(w)?w:[])}catch{S([])}})()},[]),l}function we(){const[l,S]=p.useState({});return p.useEffect(()=>{(async()=>{try{const w=await window.api.getShiftTypes?.(),A={};for(const r of w||[]){const u=await window.api.getSetting?.(`auswertung_${r.code}`);A[r.code]=u==="tag"||u==="nacht"||u==="24h"||u==="itw"?u:"off"}S(A)}catch{}})()},[]),l}function ye(){const[l,S]=p.useState([]),[w,A]=p.useState([]);return p.useEffect(()=>{(async()=>{try{const r=await window.api.getRtwVehicles?.();Array.isArray(r)&&S(r)}catch{}try{const r=await window.api.getNefVehicles?.();Array.isArray(r)&&A(r)}catch{}})()},[]),{rtw:l,nef:w}}function be(l){const[S,w]=p.useState({}),[A,r]=p.useState({});return p.useEffect(()=>{(async()=>{try{const u=await window.api.getRtwVehicleActivations?.(l),P={};(u||[]).forEach(I=>{const W=Number(I.vehicleId),Z=Number(I.month),st=P[W]||Array(12).fill(!0);st[Z-1]=!!I.enabled,P[W]=st}),w(P)}catch{}try{const u=await window.api.getNefVehicleActivations?.(l),P={};(u||[]).forEach(I=>{const W=Number(I.vehicleId),Z=Number(I.month),st=P[W]||Array(12).fill(!0);st[Z-1]=!!I.enabled,P[W]=st}),r(P)}catch{}})()},[l]),{rtwActs:S,nefActs:A}}function ve(){const[l,S]=p.useState(1);return p.useEffect(()=>{(async()=>{try{const w=await window.api.getSetting?.("department");S(Number(w)||1)}catch{}})()},[]),l}function xe(){const[l,S]=p.useState([]);return p.useEffect(()=>{(async()=>{try{const w=await window.api.getDeptPatterns?.(),A=(u,P=21)=>(u||[]).slice(0,P).concat(Array(P).fill("")).slice(0,P).map(I=>I==="1"||I==="2"||I==="3"?I:""),r=(w||[]).map(u=>({startDate:String(u.startDate),pattern:A(String(u.pattern||"").split(",").map(P=>P.trim()),21)}));S(r)}catch{}})()},[]),l}function Se(l,S){const w=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())).toISOString().slice(0,10);if(!S||S.length===0)return;const A=[...S].sort((W,Z)=>W.startDate.localeCompare(Z.startDate));let r=A[0];for(const W of A)if(W.startDate<=w)r=W;else break;const u=new Date((r?.startDate||"1970-01-01")+"T00:00:00Z"),P=Math.floor((new Date(w+"T00:00:00Z").getTime()-u.getTime())/(1e3*60*60*24)),I=r?.pattern||[];return I.length?I[(P%21+21)%21]:void 0}function je(l,S,w){const A=Array(12).fill(0);for(let r=0;r<12;r++){const u=new Date(l,r+1,0).getDate();let P=0;for(let I=1;I<=u;I++){const W=new Date(l,r,I),Z=Se(W,w);Z&&String(S)===Z&&P++}A[r]=P}return A}function De(l,S,w,A,r){const u=Array(12).fill(0),P=Array(12).fill(0),I=Array(12).fill(0);for(let W=0;W<12;W++)P[W]=(S.rtw||[]).filter(Z=>(w.rtwActs[Z.id]??Array(12).fill(!0))[W]!==!1).length,I[W]=(S.nef||[]).filter(Z=>(w.nefActs[Z.id]??Array(12).fill(!0))[W]!==!1).length;for(let W=0;W<12;W++){const Z=A[W]*(P[W]*4+I[W]*2);u[W]=Z+(r[W]||0)}return u}function _e(l,S,w){const A=Array.from({length:12},()=>new Set);for(const r of S||[])try{if(String(r.personType)!=="person")continue;const u=String(r.value||"").trim();if(!u||(w[u]||"off")==="off")continue;const I=String(r.date),Z=new Date(I+"T00:00:00Z").getUTCMonth(),st=`${r.personType}:${r.personId}`;A[Z].add(st)}catch{}return A.map(r=>r.size)}function ke(l,S){return l.map((w,A)=>S[A]>0?+(w/S[A]).toFixed(2):0)}const Ae=()=>{const l=pe(),S=he(l),w=me(),A=ge(),r=we(),{rtw:u,nef:P}=ye(),{rtwActs:I,nefActs:W}=be(l),Z=ve(),st=xe(),et=p.useMemo(()=>{const N=Array(12).fill(0);for(const O of S||[])try{const J=String(O.date);if(!J)continue;const T=new Date(J+"T00:00:00Z").getUTCMonth(),Q=String(O.type||""),mt=String(O.value||"").trim();(Q.startsWith("itw_")||mt&&r[mt]==="itw")&&(N[T]+=1)}catch{}return N},[S,r]),R=p.useMemo(()=>je(l,Z,st),[l,Z,JSON.stringify(st)]),lt=p.useMemo(()=>De(l,{rtw:u,nef:P},{rtwActs:I,nefActs:W},R,et),[l,u,P,I,W,R,et]),rt=p.useMemo(()=>_e(l,S,r),[l,S,r]),_t=p.useMemo(()=>{const N={},O=T=>N[T]||=Array(12).fill(0);for(const T of S||[])try{if(String(T.personType)!=="person")continue;const Q=String(T.value||"").trim();if(!Q||r[Q]!=="24h")continue;const mt=String(T.date),Tt=new Date(mt+"T00:00:00Z").getUTCMonth();O(Number(T.personId))[Tt]+=1}catch{}return(w||[]).map(T=>({id:T.id,name:`${T.vorname?T.vorname+" ":""}${T.name}`.trim(),counts:N[T.id]||Array(12).fill(0)}))},[S,w,r]),wt=p.useMemo(()=>{const N={},O=T=>N[T]||=Array(12).fill(0);for(const T of S||[])try{if(String(T.personType)!=="person")continue;const Q=String(T.date),mt=new Date(Q+"T00:00:00Z").getUTCMonth(),bt=String(T.type||""),Tt=String(T.value||"").trim();(bt.startsWith("itw_")||Tt&&r[Tt]==="itw")&&(O(Number(T.personId))[mt]+=1)}catch{}return(w||[]).map(T=>({id:T.id,name:`${T.vorname?T.vorname+" ":""}${T.name}`.trim(),counts:N[T.id]||Array(12).fill(0)}))},[S,w,r]),X=p.useMemo(()=>{const N={};for(const O of wt||[])N[O.id]=O.counts;return(_t||[]).map(O=>({id:O.id,name:O.name,counts:O.counts.map((J,T)=>J+(N[O.id]?.[T]||0))}))},[_t,wt]),ct=p.useMemo(()=>{const N={},O=Q=>N[Q]||=Array(12).fill(0),J=/^rtw\d+_(tag|nacht)_2$/;for(const Q of S||[])try{if(String(Q.personType)!=="azubi")continue;const mt=String(Q.type||"");if(!J.test(mt))continue;const bt=String(Q.date),Jt=new Date(bt+"T00:00:00Z").getUTCMonth();O(Number(Q.personId))[Jt]+=1}catch{}return(A||[]).map(Q=>({id:Q.id,name:`${Q.vorname?Q.vorname+" ":""}${Q.name} (Azubi)`.trim(),counts:N[Q.id]||Array(12).fill(0)}))},[S,A]),dt=p.useMemo(()=>{const N=Array(12).fill(0);for(const O of ct||[])O.counts.forEach((J,T)=>{N[T]+=J});return N},[ct]),ot=p.useMemo(()=>lt.map((N,O)=>Math.max(0,N-(dt[O]||0))),[lt,dt]),nt=p.useMemo(()=>ke(ot,rt),[ot,rt]),q=p.useMemo(()=>{const N=Array(12).fill(0),O=X||[];for(let J=0;J<12;J++){let T=0,Q=0;for(const mt of O){const bt=Number(mt.counts[J]||0);bt>0&&(T+=bt,Q++)}N[J]=Q>0?Math.round(T/Q):0}return N},[X]),ht=N=>new Intl.NumberFormat("de-DE").format(Number(N||0)),k={table:{borderCollapse:"collapse",minWidth:980},thSticky:{position:"sticky",top:0,background:"#fff",zIndex:2,border:"1px solid #ccc",padding:"6px 8px"},thStickyName:{position:"sticky",top:0,left:0,background:"#fff",zIndex:4,border:"1px solid #ccc",padding:"6px 8px"},nameSticky:{position:"sticky",left:0,background:"#fff",zIndex:3,border:"1px solid #ccc",padding:"6px 8px",minWidth:240,textAlign:"left"},td:{border:"1px solid #ccc",padding:"6px 8px",textAlign:"right"},tdLeft:{border:"1px solid #ccc",padding:"6px 8px",textAlign:"left"},kpiRow:{background:"#f9fafb"},zebra1:{background:"#fff"},zebra2:{background:"#f6f8fb"},sectionSep:{height:8,background:"#eaeef3"}};return t.jsxs("div",{style:{padding:16},children:[t.jsxs("h2",{children:["Werte – ",l]}),t.jsx("div",{style:{overflow:"auto",maxHeight:"70vh",border:"1px solid #e0e0e0",borderRadius:8},children:t.jsxs("table",{style:k.table,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:k.thStickyName,children:"Name"}),qt.map((N,O)=>t.jsx("th",{style:k.thSticky,children:N},O)),t.jsx("th",{style:k.thSticky,children:"Summe"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsxs("td",{style:{...k.nameSticky,...k.kpiRow},children:[t.jsx("div",{style:{fontWeight:600},children:"Positionen gesamt (netto)"}),t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Abteilungsschichten × (RTW×4 + NEF×2) + ITW − Azubis (Maschinist)"})]}),ot.map((N,O)=>t.jsx("td",{style:{...k.td,...k.kpiRow},children:ht(N)},O)),t.jsx("td",{style:{...k.td,...k.kpiRow}})]}),t.jsxs("tr",{children:[t.jsxs("td",{style:{...k.nameSticky,...k.kpiRow},children:[t.jsx("div",{style:{fontWeight:600},children:"Anzahl Personal"}),t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Stammpersonal mit mind. einer Schicht (Auswertung ≠ off) im Monat"})]}),rt.map((N,O)=>t.jsx("td",{style:{...k.td,...k.kpiRow},children:ht(N)},O)),t.jsx("td",{style:{...k.td,...k.kpiRow}})]}),t.jsxs("tr",{children:[t.jsxs("td",{style:{...k.nameSticky,...k.kpiRow},children:[t.jsx("div",{style:{fontWeight:600},children:"Anzahl Azubis (Maschinist)"}),t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Summe der Azubi‑Maschinist‑Einsätze je Monat"})]}),dt.map((N,O)=>t.jsx("td",{style:{...k.td,...k.kpiRow},children:ht(N)},O)),t.jsx("td",{style:{...k.td,...k.kpiRow}})]}),t.jsxs("tr",{children:[t.jsxs("td",{style:{...k.nameSticky,...k.kpiRow},children:[t.jsx("div",{style:{fontWeight:600},children:"ITW‑Schichten"}),t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Summe aller ITW‑Einsätze (Slot oder Auswertung = ITW)"})]}),et.map((N,O)=>t.jsx("td",{style:{...k.td,...k.kpiRow},children:ht(N)},O)),t.jsx("td",{style:{...k.td,...k.kpiRow}})]}),t.jsxs("tr",{children:[t.jsxs("td",{style:{...k.nameSticky,...k.kpiRow},children:[t.jsx("div",{style:{fontWeight:600},children:"Mittelwert (24h + ITW)"}),t.jsxs("div",{style:{fontSize:12,color:"#666"},children:["Durchschnitt pro Monat über Personen mit ",">"," 0 (gerundet)"]})]}),q.map((N,O)=>t.jsx("td",{style:{...k.td,...k.kpiRow},children:ht(N)},O)),t.jsx("td",{style:{...k.td,...k.kpiRow}})]}),t.jsxs("tr",{children:[t.jsxs("td",{style:{...k.nameSticky,...k.kpiRow},children:[t.jsx("div",{style:{fontWeight:600},children:"Schichten je Person"}),t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Positionen gesamt ÷ Anzahl Personal"})]}),nt.map((N,O)=>t.jsx("td",{style:{...k.td,...k.kpiRow},children:ht(N)},O)),t.jsx("td",{style:{...k.td,...k.kpiRow}})]}),t.jsx("tr",{children:t.jsx("td",{style:{...k.sectionSep},colSpan:qt.length+2})}),X.map(N=>{const O=N.counts.reduce((J,T)=>J+T,0);return t.jsxs("tr",{style:Number(N.id)%2===0?k.zebra1:k.zebra2,children:[t.jsx("td",{style:k.nameSticky,children:N.name}),N.counts.map((J,T)=>t.jsx("td",{style:k.td,children:J?ht(J):""},T)),t.jsx("td",{style:k.td,children:O?ht(O):""})]},N.id)}),t.jsx("tr",{children:t.jsx("td",{colSpan:qt.length+2,style:{...k.tdLeft,background:"#eef2f7",fontWeight:600},children:"Azubis"})}),ct.map(N=>{const O=N.counts.reduce((J,T)=>J+T,0);return t.jsxs("tr",{style:Number(N.id)%2===0?k.zebra1:k.zebra2,children:[t.jsx("td",{style:k.nameSticky,children:N.name}),N.counts.map((J,T)=>t.jsx("td",{style:k.td,children:J?ht(J):""},T)),t.jsx("td",{style:k.td,children:O?ht(O):""})]},`az_${N.id}`)})]})]})})]})},Me="_container_1spmd_1",Ne="_select_1spmd_26",Te="_rtwTable_1spmd_75",$e="_nefTable_1spmd_87",Ie="_tableHead_1spmd_98",Ce="_tableHeadFull_1spmd_104",Re="_tableHeadEmpty_1spmd_111",ze="_rowLabel_1spmd_112",Pe="_itwRacks_1spmd_153",Ee="_itwRack_1spmd_153",We="_itwCard_1spmd_164",Oe="_itwCardHeader_1spmd_173",Fe="_itwCardWrap_1spmd_181",Le="_itwDivider_1spmd_185",Ve="_itwRow_1spmd_192",Be="_itwRoleLabel_1spmd_193",Ue="_layoutRow_1spmd_196",Ye="_assignCol_1spmd_202",He="_sidebar_1spmd_205",Ze="_sidebarTitle_1spmd_215",Ke="_sidebarSub_1spmd_220",qe="_sidebarList_1spmd_225",Je="_sidebarItem_1spmd_230",Ge="_sidebarName_1spmd_237",Qe="_sidebarVal_1spmd_241",Xe="_tabs_1spmd_249",tn="_tab_1spmd_98",en="_toggleBtn_1spmd_256",nn="_tabActive_1spmd_269",sn="_toggleGroup_1spmd_270",an="_dayDivider_1spmd_273",y={container:Me,select:Ne,rtwTable:Te,nefTable:$e,tableHead:Ie,tableHeadFull:Ce,tableHeadEmpty:Re,rowLabel:ze,itwRacks:Pe,itwRack:Ee,itwCard:We,itwCardHeader:Oe,itwCardWrap:Fe,itwDivider:Le,itwRow:Ve,itwRoleLabel:Be,layoutRow:Ue,assignCol:Ye,sidebar:He,sidebarTitle:Ze,sidebarSub:Ke,sidebarList:qe,sidebarItem:Je,sidebarName:Ge,sidebarVal:Qe,tabs:Xe,tab:tn,toggleBtn:en,tabActive:nn,toggleGroup:sn,dayDivider:an},ee=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],on=({currentMonth:l,onMonthChange:S,personnel:w,azubis:A,roster:r,year:u,shiftPattern:P,deptPatternSeqs:I=[],onRosterChanged:W,onEntryAssigned:Z})=>{const[st,et]=p.useState(1),[R,lt]=p.useState(r||{}),[rt,_t]=p.useState([]),[wt,X]=p.useState([]),[ct,dt]=p.useState(!1),[ot,nt]=p.useState([]),[q,ht]=p.useState({}),[k,N]=p.useState([]),[O,J]=p.useState([]),[T,Q]=p.useState("rtwnef"),[mt,bt]=p.useState([]),[Tt,Jt]=p.useState(""),[It,Et]=p.useState({}),[Ct,Wt]=p.useState({}),[Ot,Gt]=p.useState([]),[Ft,Lt]=p.useState(new Set),[se,Qt]=p.useState(new Set),[Rt,Xt]=p.useState("");p.useEffect(()=>{(async()=>{try{const s=await window.api.getSetting("department");s&&et(Number(s))}catch{}try{const s=await window.api.getRtwVehicles?.();Array.isArray(s)&&_t(s)}catch{}try{const s=await window.api.getNefVehicles?.();Array.isArray(s)&&X(s)}catch{}try{const s=await window.api.getRtwVehicleActivations?.(u),j={};(s||[]).forEach(m=>{const d=Number(m.vehicleId),x=Number(m.month),i=j[d]||Array(12).fill(!0);i[x-1]=!!m.enabled,j[d]=i}),Et(j)}catch{}try{const s=await window.api.getNefVehicleActivations?.(u),j={};(s||[]).forEach(m=>{const d=Number(m.vehicleId),x=Number(m.month),i=j[d]||Array(12).fill(!0);i[x-1]=!!m.enabled,j[d]=i}),Wt(j)}catch{}try{const s=await window.api.getSetting("itw");dt(s==="true"||s==="1")}catch{}try{const s=(m,d=21)=>(m||[]).slice(0,d).concat(Array(d).fill("")).slice(0,d).map(x=>x==="IW"?"IW":""),j=await window.api.getItwPatterns?.();if(Array.isArray(j)&&j.length>0){const m=j.map(d=>({startDate:String(d.startDate),pattern:s(String(d.pattern).split(",").map(x=>x.trim()),21)}));m.sort((d,x)=>d.startDate.localeCompare(x.startDate)),Gt(m)}}catch{}try{const s=await window.api.getShiftTypes();nt(s||[]);const j={};for(const m of s||[]){const d=await window.api.getSetting(`auswertung_${m.code}`);j[m.code]=d||"off"}ht(j)}catch{}try{const s=await window.api.getItwDoctors?.();Array.isArray(s)&&J(s)}catch{}try{const s=await window.api.getHolidaysForYear?.(u),j=new Set((s||[]).map(m=>String(m.date)));Lt(j)}catch{}})();const b=async()=>{try{const s=await window.api.getSetting("year"),j=Number(s||new Date().getFullYear());try{const m=await window.api.getRtwVehicles?.();Array.isArray(m)&&_t(m)}catch{}try{const m=await window.api.getNefVehicles?.();Array.isArray(m)&&X(m)}catch{}try{const m=await window.api.getRtwVehicleActivations?.(j),d={};(m||[]).forEach(x=>{const i=Number(x.vehicleId),h=Number(x.month),M=d[i]||Array(12).fill(!0);M[h-1]=!!x.enabled,d[i]=M}),Et(d)}catch{}try{const m=await window.api.getNefVehicleActivations?.(j),d={};(m||[]).forEach(x=>{const i=Number(x.vehicleId),h=Number(x.month),M=d[i]||Array(12).fill(!0);M[h-1]=!!x.enabled,d[i]=M}),Wt(d)}catch{}try{const m=(x,i=21)=>(x||[]).slice(0,i).concat(Array(i).fill("")).slice(0,i).map(h=>h==="IW"?"IW":""),d=await window.api.getItwPatterns?.();if(Array.isArray(d)&&d.length>0){const x=d.map(i=>({startDate:String(i.startDate),pattern:m(String(i.pattern).split(",").map(h=>h.trim()),21)}));x.sort((i,h)=>i.startDate.localeCompare(h.startDate)),Gt(x)}}catch{}try{const m=await window.api.getHolidaysForYear?.(j),d=new Set((m||[]).map(x=>String(x.date)));Lt(d)}catch{}}catch{}};window.api?.onSettingsUpdated?.(b);const C=async()=>{try{const s=await window.api.getSetting("year"),j=Number(s||new Date().getFullYear()),m=await window.api.getDutyRoster(j),d={};(m||[]).forEach(x=>{if(!x||!x.date)return;let i="";x.personType==="person"?i=`p_${x.personId}`:x.personType==="azubi"?i=`a_${x.personId}`:x.personType==="doctor"&&(i=`d_${x.personId}`),i&&(d[i]||(d[i]={}),d[i][String(x.date)]={value:x.value,type:x.type})}),lt(d)}catch(s){console.warn("[MonthTabs] duty-roster-updated reload failed",s)}};return window.api?.onDutyRosterUpdated?.(C),()=>{window.api?.offSettingsUpdated?.(b)}},[]),p.useEffect(()=>lt(r||{}),[r]),p.useEffect(()=>{bt((rt||[]).map(v=>v.name||""))},[rt]),p.useEffect(()=>{const v=new Date(u,l+1,0).getDate(),b=[];let C=0;for(let s=0;s<l;++s)C+=new Date(u,s+1,0).getDate();for(let s=1;s<=v;++s){const j=C+(s-1),m=new Date(u,l,s);let d;if(Array.isArray(I)&&I.length>0){const x=new Date(Date.UTC(u,l,s)).toISOString().slice(0,10),i=[...I].sort((a,K)=>a.startDate.localeCompare(K.startDate));let h=i[0];for(const a of i)if(a.startDate<=x)h=a;else break;const M=new Date((h?.startDate||"1970-01-01")+"T00:00:00Z"),G=new Date(x+"T00:00:00Z"),e=Math.floor((G.getTime()-M.getTime())/(1e3*60*60*24)),$=h?.pattern||[];d=$.length?$[(e%21+21)%21]:void 0}else P&&P.length&&(d=P[j%P.length]);if(d===void 0||String(st)===d){const x=new Date(Date.UTC(u,l,s)).toISOString().slice(0,10),i=m.toLocaleDateString("de-DE",{weekday:"short"});b.push({date:x,weekday:i,day:s,dayOfYear:j})}}N(b)},[l,u,st,P,JSON.stringify(I)]),p.useEffect(()=>{(async()=>{try{const b=await window.api.getRtwVehicleActivations?.(u),C={};(b||[]).forEach(s=>{const j=Number(s.vehicleId),m=Number(s.month),d=C[j]||Array(12).fill(!0);d[m-1]=!!s.enabled,C[j]=d}),Et(C)}catch{}try{const b=await window.api.getNefVehicleActivations?.(u),C={};(b||[]).forEach(s=>{const j=Number(s.vehicleId),m=Number(s.month),d=C[j]||Array(12).fill(!0);d[m-1]=!!s.enabled,C[j]=d}),Wt(C)}catch{}})()},[u]),p.useEffect(()=>{Qt(new Set),Xt("")},[l,u]),p.useEffect(()=>{(async()=>{try{const v=await window.api.getHolidaysForYear?.(u),b=new Set((v||[]).map(C=>String(C.date)));Lt(b)}catch{}})()},[u]);const Vt=(v,b)=>{try{const C=R?.[v]?.[b]?.value,s=r?.[v]?.[b]?.value;return C??s??""}catch{return""}},gt=(v,b)=>{if(b==="any")return!0;const C=q[v]||"off";return b==="tag"?C==="tag"||C==="24h":b==="nacht"?C==="nacht"||C==="24h":b==="24h"?C==="24h":!1},Bt=(v,b)=>{const C=Array.from(new Set([...Object.keys(R||{}),...Object.keys(r||{})]));for(const s of C){const j=R?.[s]?.[v]||r?.[s]?.[v];if(!j)continue;if(String(j.type||"")===b)return s.startsWith("p_")?`p:${s.slice(2)}`:s.startsWith("a_")?`a:${s.slice(2)}`:`p:${s}`}return""},vt=v=>{if(!v)return"";try{const[b,C]=v.split(":"),s=Number(C);if(b==="p"){const j=w.find(m=>m.id===s);return j?`${j.name}`:`Person ${s}`}if(b==="a"){const j=A.find(m=>m.id===s);return j?`${j.name}`:`Azubi ${s}`}if(b==="d"){const j=O.find(m=>m.id===s);return j?`${j.name}`:`Arzt ${s}`}}catch{}return v},xt=async(v,b,C,s)=>{if(!C)return;const[j,m]=C.split(":"),d=Number(m),x=j==="a"?"azubi":j==="d"?"doctor":"person";try{await window.api.assignSlot({personId:d,personType:x,date:v,slotType:s||""});const i=x==="person"?`p_${d}`:x==="azubi"?`a_${d}`:`d_${d}`;lt(h=>{const M=h[i]||{},G={...M[v]||{}};return G.type=s||"",{...h,[i]:{...M,[v]:G}}}),Z&&Z(i,v,R[i]?.[v]?.value||"",s||""),W&&W()}catch(i){console.warn("[MonthTabs] handleAssign failed",i)}},Ut=async(v,b)=>{const C=Bt(b,v);if(C)try{const[s,j]=C.split(":"),m=Number(j),d=s==="a"?"azubi":s==="d"?"doctor":"person";await window.api.assignSlot({personId:m,personType:d,date:b,slotType:""});const x=d==="person"?`p_${m}`:d==="azubi"?`a_${m}`:`d_${m}`;lt(i=>{const h=i[x]||{},M={...h[b]||{}};return M&&M.type&&delete M.type,{...i,[x]:{...h,[b]:M}}}),Z&&Z(x,b,R[x]?.[b]?.value||"",""),W&&W()}catch(s){console.warn("[MonthTabs] clearAssignedForDate failed",s)}};return t.jsxs("div",{style:{padding:12},children:[t.jsx("div",{style:{margin:"4px 0 10px 0"},children:t.jsxs("span",{style:{fontSize:18,fontWeight:700},children:[T==="rtwnef"?"RTW Einteilung":"ITW Einteilung"," (",ee[l],")"]})}),t.jsx("div",{className:y.tabs,children:ee.map((v,b)=>t.jsx("button",{onClick:()=>S(b),className:`${y.tab} ${l===b?y.tabActive:""}`,children:v},b))}),t.jsxs("div",{className:y.toggleGroup,children:[t.jsx("button",{onClick:()=>Q("rtwnef"),className:y.toggleBtn,style:{background:T==="rtwnef"?"#f3f4f6":void 0},children:"RTW/NEF"}),t.jsx("button",{onClick:()=>Q("itw"),disabled:!ct,className:y.toggleBtn,style:{background:T==="itw"?"#f3f4f6":void 0,opacity:ct?1:.5},children:"ITW"})]}),T==="rtwnef"&&t.jsxs("div",{className:y.layoutRow,children:[t.jsx("div",{className:y.assignCol,children:k.map(v=>{const b=m=>Vt(m,v.date),C=m=>Bt(v.date,m),s=async m=>Ut(m,v.date),j=k.length>0&&k[0].date===v.date;return t.jsxs("div",{style:{marginBottom:12},children:[(()=>{const d=new Date(v.date+"T00:00:00").toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"});return t.jsxs("div",{style:{position:"sticky",top:0,background:"var(--bg)",zIndex:2,textAlign:"left",fontWeight:600,marginBottom:6,padding:"2px 0"},children:[d," ",t.jsxs("small",{style:{fontWeight:400},children:["(",v.weekday,")"]})]})})(),T==="rtwnef"&&t.jsx("div",{className:y.dayDivider}),t.jsx("div",{children:t.jsxs("div",{className:y.container,children:[(rt||[]).map((m,d)=>(It[m.id]??Array(12).fill(!0))[l]!==!1?t.jsxs("div",{className:y.rtwTable,children:[j&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:y.tableHeadFull,style:{textAlign:"left",fontWeight:700,fontSize:13,color:"var(--text)"},children:m.name||mt[d]||""}),t.jsx("div",{className:y.tableHead}),t.jsx("div",{className:y.tableHead,children:"Tag"}),t.jsx("div",{className:y.tableHead,children:"Nacht"})]}),t.jsx("div",{className:y.rowLabel,children:"FzF"}),(()=>{const i=`rtw${d+1}_tag_1`,h=C(i),M=w.filter(e=>gt(b(`p_${e.id}`),"tag")&&!!e.fahrzeugfuehrer).map(e=>({value:`p:${e.id}`,label:`${e.name}`})),G=h&&!M.some(e=>e.value===h)?[{value:h,label:vt(h)},...M]:M;return t.jsxs("select",{className:y.select,value:h,onChange:e=>{const $=e.target.value;$===""?(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i)):xt(v.date,v.dayOfYear,$,i)},onKeyDown:e=>{(e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i))},children:[t.jsx("option",{value:""}),G.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})(),(()=>{const i=`rtw${d+1}_nacht_1`,h=C(i),M=w.filter(e=>gt(b(`p_${e.id}`),"nacht")&&!!e.fahrzeugfuehrer).map(e=>({value:`p:${e.id}`,label:`${e.name}`})),G=h&&!M.some(e=>e.value===h)?[{value:h,label:vt(h)},...M]:M;return t.jsxs("select",{className:y.select,value:h,onChange:e=>{const $=e.target.value;$===""?(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i)):xt(v.date,v.dayOfYear,$,i)},onKeyDown:e=>{(e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i))},children:[t.jsx("option",{value:""}),G.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})(),t.jsx("div",{className:y.rowLabel,children:"Ma"}),(()=>{const i=`rtw${d+1}_tag_2`,h=C(i),M=w.filter(a=>gt(b(`p_${a.id}`),"tag")).map(a=>({value:`p:${a.id}`,label:`${a.name}`})),G=A.filter(a=>gt(b(`a_${a.id}`),"tag")).map(a=>({value:`a:${a.id}`,label:`${a.name}`})),e=[...M,...G],$=h&&!e.some(a=>a.value===h)?[{value:h,label:vt(h)},...e]:e;return t.jsxs("select",{className:y.select,value:h,onChange:a=>{const K=a.target.value;K===""?(a.preventDefault(),a.stopPropagation(),a.currentTarget.blur(),s(i)):xt(v.date,v.dayOfYear,K,i)},onKeyDown:a=>{(a.key==="Backspace"||a.key==="Delete")&&(a.preventDefault(),a.stopPropagation(),a.currentTarget.blur(),s(i))},children:[t.jsx("option",{value:""}),$.map(a=>t.jsx("option",{value:a.value,children:a.label},a.value))]})})(),(()=>{const i=`rtw${d+1}_nacht_2`,h=C(i),M=w.filter(a=>gt(b(`p_${a.id}`),"nacht")).map(a=>({value:`p:${a.id}`,label:`${a.name}`})),G=A.filter(a=>gt(b(`a_${a.id}`),"nacht")).map(a=>({value:`a:${a.id}`,label:`${a.name}`})),e=[...M,...G],$=h&&!e.some(a=>a.value===h)?[{value:h,label:vt(h)},...e]:e;return t.jsxs("select",{className:y.select,value:h,onChange:a=>{const K=a.target.value;K===""?(a.preventDefault(),a.stopPropagation(),a.currentTarget.blur(),s(i)):xt(v.date,v.dayOfYear,K,i)},onKeyDown:a=>{(a.key==="Backspace"||a.key==="Delete")&&(a.preventDefault(),a.stopPropagation(),a.currentTarget.blur(),s(i))},children:[t.jsx("option",{value:""}),$.map(a=>t.jsx("option",{value:a.value,children:a.label},a.value))]})})(),t.jsx("div",{className:y.rowLabel,children:"Azubi"}),(()=>{const i=`rtw${d+1}_tag_3`,h=C(i),M=A.filter(e=>gt(b(`a_${e.id}`),"tag")).map(e=>({value:`a:${e.id}`,label:`${e.name}`})),G=h&&!M.some(e=>e.value===h)?[{value:h,label:vt(h)},...M]:M;return t.jsxs("select",{className:y.select,value:h,onChange:e=>{const $=e.target.value;$===""?(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i)):xt(v.date,v.dayOfYear,$,i)},onKeyDown:e=>{(e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i))},children:[t.jsx("option",{value:""}),G.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})(),(()=>{const i=`rtw${d+1}_nacht_3`,h=C(i),M=A.filter(e=>gt(b(`a_${e.id}`),"nacht")).map(e=>({value:`a:${e.id}`,label:`${e.name}`})),G=h&&!M.some(e=>e.value===h)?[{value:h,label:vt(h)},...M]:M;return t.jsxs("select",{className:y.select,value:h,onChange:e=>xt(v.date,v.dayOfYear,e.target.value,i),onKeyDown:e=>{(e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),s(i))},children:[t.jsx("option",{value:""}),G.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})()]},`rtw_${d}`):null),(wt||[]).map((m,d)=>(Ct[m.id]??Array(12).fill(!0))[l]!==!1?t.jsxs("div",{className:y.nefTable,children:[j&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:y.tableHeadFull,style:{textAlign:"left",fontWeight:700,fontSize:13,color:"var(--text)"},children:m.name||""}),t.jsx("div",{className:y.tableHeadEmpty}),(()=>{const h=m.occupancy_mode==="tag"?"Tag":"24h";return t.jsx("div",{className:y.tableHead,children:h})})()]}),t.jsx("div",{className:y.rowLabel,children:"FzF"}),(()=>{const i=`nef${d+1}_assist`,h=(()=>{let e=C(i);return!e&&d===0&&(e=C("nef_assist")),e})(),M=w.filter(e=>!!e.nef&&gt(b(`p_${e.id}`),"any")).map(e=>({value:`p:${e.id}`,label:`${e.name}`})),G=h&&!M.some(e=>e.value===h)?[{value:h,label:vt(h)},...M]:M;return t.jsxs("select",{className:y.select,value:h,onChange:e=>{const $=e.target.value;$===""?(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i),d===0&&s("nef_assist")):xt(v.date,v.dayOfYear,$,i)},onKeyDown:e=>{(e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i),d===0&&s("nef_assist"))},children:[t.jsx("option",{value:""}),G.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})(),t.jsx("div",{className:y.rowLabel,children:"Azubi"}),(()=>{const i=`nef${d+1}_azubi`,h=(()=>{let e=C(i);return!e&&d===0&&(e=C("nef_azubi")),e})(),M=A.filter(e=>gt(b(`a_${e.id}`),"any")).map(e=>({value:`a:${e.id}`,label:`${e.name}`})),G=h&&!M.some(e=>e.value===h)?[{value:h,label:vt(h)},...M]:M;return t.jsxs("select",{className:y.select,value:h,onChange:e=>xt(v.date,v.dayOfYear,e.target.value,i),onKeyDown:e=>{(e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),s(i),d===0&&s("nef_azubi"))},children:[t.jsx("option",{value:""}),G.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})()]},`nef_${d}`):null)]})})]},v.date)})}),(()=>{const v=new Date(u,l+1,0).getDate(),b=[];for(let n=1;n<=v;n++)b.push(new Date(Date.UTC(u,l,n)).toISOString().slice(0,10));const C=(()=>{let n=0;for(let c=1;c<=v;c++){const o=new Date(Date.UTC(u,l,c)).toISOString().slice(0,10),f=[...I||[]].sort((it,ft)=>it.startDate.localeCompare(ft.startDate));let g=f[0];for(const it of f)if(it.startDate<=o)g=it;else break;const z=new Date((g?.startDate||"1970-01-01")+"T00:00:00Z"),E=new Date(o+"T00:00:00Z"),D=Math.floor((E.getTime()-z.getTime())/(1e3*60*60*24)),Y=g?.pattern||[],V=Y.length?Y[(D%21+21)%21]:"";V&&String(st)===V&&n++}return n})(),s=(rt||[]).filter(n=>(It[n.id]??Array(12).fill(!0))[l]!==!1).length,j=(wt||[]).filter(n=>(Ct[n.id]??Array(12).fill(!0))[l]!==!1).length,m=(()=>{let n=0;const c=Array.from(new Set([...Object.keys(R||{}),...Object.keys(r||{})]));for(const o of c)for(const f of b){const g=R?.[o]?.[f]||r?.[o]?.[f];if(!g)continue;const z=String(g.type||""),E=String(g.value||"").trim();(z.startsWith("itw_")||E&&q[E]==="itw")&&n++}return n})(),d=(()=>{let n=0;const c=/^rtw\d+_(tag|nacht)_2$/;for(const o of A||[]){const f=`a_${o.id}`;for(const g of b){const z=String((R?.[f]?.[g]||r?.[f]?.[g])?.type||"");c.test(z)&&n++}}return n})(),x=Math.max(0,C*(s*4+j*2)+m-d),i=(()=>{const n=new Set;for(const c of w||[]){const o=`p_${c.id}`;for(const f of b){const g=String((R?.[o]?.[f]||r?.[o]?.[f])?.value||"").trim();if(g&&(q[g]||"off")!=="off"){n.add(o);break}}}return n.size})(),h=i>0?x/i:0,M=(()=>{const n={};for(const c of w||[]){const o=`p_${c.id}`;let f=0,g=0;for(const z of b){const E=R?.[o]?.[z]||r?.[o]?.[z],D=String(E?.value||"").trim();D&&q[D]==="24h"&&f++,(String(E?.type||"").startsWith("itw_")||D&&q[D]==="itw")&&g++}n[o]=f+g}return n})(),G=(()=>{const n=Object.values(M).filter(o=>o>0);if(n.length===0)return 0;const c=n.reduce((o,f)=>o+f,0);return Math.round(c/n.length)})(),e={},$={},a={},K={};for(const n of w||[]){const c=`p_${n.id}`;let o=0,f=0,g=0,z=0,E=0;for(const D of b){const Y=R?.[c]?.[D]||r?.[c]?.[D],V=String(Y?.type||"");/^rtw\d+_(tag|nacht)_(1|2)$/.test(V)&&(o+=1),/^rtw\d+_tag_(1|2)$/.test(V)&&(f+=1),/^rtw\d+_nacht_(1|2)$/.test(V)?g+=1:/^itw_row_[12]$/.test(V)?o+=1:/^nef(\d+)?_assist$/.test(V)&&(o+=2),/^itw_row_[12]$/.test(V)&&(E+=1),/^nef(\d+)?_assist$/.test(V)&&(z+=2)}e[c]=o,$[c]={tag:f,nacht:g},a[c]=z,K[c]=E}const tt=n=>{const c=new Date(u,n+1,0).getDate(),o=[];for(let _=1;_<=c;_++)o.push(new Date(Date.UTC(u,n,_)).toISOString().slice(0,10));const f=(()=>{let _=0;for(let H=1;H<=c;H++){const F=new Date(Date.UTC(u,n,H)).toISOString().slice(0,10),B=[...I||[]].sort((Dt,Zt)=>Dt.startDate.localeCompare(Zt.startDate));let U=B[0];for(const Dt of B)if(Dt.startDate<=F)U=Dt;else break;const at=new Date((U?.startDate||"1970-01-01")+"T00:00:00Z"),ut=new Date(F+"T00:00:00Z"),pt=Math.floor((ut.getTime()-at.getTime())/(1e3*60*60*24)),Nt=U?.pattern||[],Pt=Nt.length?Nt[(pt%21+21)%21]:"";Pt&&String(st)===Pt&&_++}return _})(),g=(rt||[]).filter(_=>(It[_.id]??Array(12).fill(!0))[n]!==!1).length,z=(wt||[]).filter(_=>(Ct[_.id]??Array(12).fill(!0))[n]!==!1).length,E=(()=>{let _=0;const H=Array.from(new Set([...Object.keys(R||{}),...Object.keys(r||{})]));for(const F of H)for(const B of o){const U=R?.[F]?.[B]||r?.[F]?.[B];if(!U)continue;const at=String(U.type||""),ut=String(U.value||"").trim();(at.startsWith("itw_")||ut&&q[ut]==="itw")&&_++}return _})(),D=(()=>{let _=0;const H=/^rtw\d+_(tag|nacht)_2$/;for(const F of A||[]){const B=`a_${F.id}`;for(const U of o){const at=String((R?.[B]?.[U]||r?.[B]?.[U])?.type||"");H.test(at)&&_++}}return _})(),Y=Math.max(0,f*(g*4+z*2)+E-D),V=(()=>{const _=new Set;for(const H of w||[]){const F=`p_${H.id}`;for(const B of o){const U=String((R?.[F]?.[B]||r?.[F]?.[B])?.value||"").trim();if(U&&(q[U]||"off")!=="off"){_.add(F);break}}}return _.size})(),it=V>0?Y/V:0,ft=(()=>{const _={};for(const H of w||[]){const F=`p_${H.id}`;let B=0,U=0;for(const at of o){const ut=R?.[F]?.[at]||r?.[F]?.[at],pt=String(ut?.value||"").trim();pt&&q[pt]==="24h"&&B++,(String(ut?.type||"").startsWith("itw_")||pt&&q[pt]==="itw")&&U++}_[F]=B+U}return _})(),Mt=(()=>{const _=Object.values(ft).filter(F=>F>0);if(_.length===0)return 0;const H=_.reduce((F,B)=>F+B,0);return Math.round(H/_.length)})(),jt={};for(const _ of w||[]){const H=`p_${_.id}`,F=ft[H]||0,B=Mt,U=it,at=B>0&&U>0&&F>0?Math.round(U/B*F):0;jt[H]=at}return jt},L={};for(let n=0;n<12;n++){const c=tt(n);for(const[o,f]of Object.entries(c))L[o]=(L[o]||0)+(f||0)}const yt={};for(const n of w||[]){const c=`p_${n.id}`;let o=0;for(let f=0;f<12;f++){const g=new Date(u,f+1,0).getDate();for(let z=1;z<=g;z++){const E=new Date(Date.UTC(u,f,z)).toISOString().slice(0,10),D=R?.[c]?.[E]||r?.[c]?.[E],Y=String(D?.type||"");/^rtw\d+_(tag|nacht)_(1|2)$/.test(Y)||/^itw_row_[12]$/.test(Y)?o+=1:/^nef(\d+)?_assist$/.test(Y)&&(o+=2)}}yt[c]=o}const kt=(w||[]).map(n=>{const c=`p_${n.id}`,o=M[c]||0,f=G,g=h,z=f>0&&g>0&&o>0?Math.round(g/f*o):"",E=e[c]||0,D=$[c]||{tag:0,nacht:0},Y=a[c]||0,V=K[c]||0,it=(()=>{const Mt=L[c]||0,jt=yt[c]||0;return Mt-jt})(),ft=Number(n.teilzeit??100)||100;return{name:n.name,target:z,count:E,tag:D.tag,nacht:D.nacht,nef:Y,itw:V,rest:it,teilzeit:ft}}),St=kt.map((n,c)=>({...n,idx:c})).filter(n=>typeof n.target=="number"&&n.target>0).map(n=>{const c=Math.max(.01,(n.teilzeit||100)/100);return n.rest/c}),At=St.length?Math.min(...St):0,zt=St.length?Math.max(...St):0,Ht=n=>{const o=(D=>Math.max(0,Math.min(1,D)))(n),f=(D,Y,V)=>D+(Y-D)*V,g=Math.round(f(34,239,o)),z=Math.round(f(197,68,o)),E=Math.round(f(94,68,o));return{r:g,g:z,b:E}};return t.jsxs("aside",{className:y.sidebar,children:[t.jsx("div",{className:y.sidebarTitle,children:"Kontrolle"}),t.jsx("div",{className:y.sidebarSub}),t.jsxs("div",{className:y.sidebarList,children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto auto auto auto",alignItems:"center",gap:8,fontWeight:600,fontSize:12,color:"#374151",marginBottom:4},children:[t.jsx("span",{}),t.jsx("span",{style:{textAlign:"center"},children:"Soll | Ist"}),t.jsx("span",{style:{textAlign:"center"},children:"NEF"}),t.jsx("span",{style:{textAlign:"center"},children:"ITW"}),t.jsx("span",{style:{textAlign:"center"},children:"Gesamt"}),t.jsx("span",{})]}),kt.map((n,c)=>{const o=typeof n.target=="number"&&n.target>0;let f;if(o&&zt>At){const g=Math.max(.01,(n.teilzeit||100)/100),E=(n.rest/g-At)/(zt-At),D=Ht(E),Y=`rgba(${D.r}, ${D.g}, ${D.b}, 0.18)`,V=`1px solid rgba(${D.r}, ${D.g}, ${D.b}, 0.35)`;f={background:Y,borderRadius:4,border:V,padding:"0 6px"}}return t.jsxs("div",{className:y.sidebarItem,style:{display:"grid",gridTemplateColumns:"1fr auto auto auto auto auto",alignItems:"center",gap:8},children:[t.jsx("span",{className:y.sidebarName,children:n.name}),t.jsx("span",{className:y.sidebarVal,children:(n.target===""?"–":n.target)+" | "+n.count}),t.jsx("span",{className:y.sidebarVal,children:n.nef}),t.jsx("span",{className:y.sidebarVal,children:n.itw}),t.jsx("span",{className:y.sidebarVal,style:f,children:Number.isFinite(n.rest)?n.rest:"–"}),t.jsxs("div",{style:{gridColumn:"1 / span 6",display:"flex",alignItems:"center",gap:6},children:[t.jsx("div",{style:{fontSize:10,color:"#4b5563",minWidth:56},children:`T:${n.tag} / N:${n.nacht}`}),t.jsxs("div",{style:{position:"relative",width:100,height:8,background:"#eef2f7",borderRadius:4},children:[t.jsx("div",{style:{position:"absolute",left:"50%",top:0,bottom:0,width:1,background:"#cbd5e1"}}),(()=>{const g=(n.tag||0)+(n.nacht||0),z=g>0?Math.min(1,(n.nacht||0)/g):0,E=g>0?Math.min(1,(n.tag||0)/g):0;return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"absolute",right:"50%",width:`${z*50}%`,top:0,bottom:0,background:"#60a5fa",borderTopLeftRadius:4,borderBottomLeftRadius:4}}),t.jsx("div",{style:{position:"absolute",left:"50%",width:`${E*50}%`,top:0,bottom:0,background:"#fb923c",borderTopRightRadius:4,borderBottomRightRadius:4}})]})})()]})]})]},c)})]})]})})()]}),T==="itw"&&ct&&t.jsxs("div",{className:y.layoutRow,children:[t.jsx("div",{className:y.assignCol,children:t.jsxs("div",{className:y.itwRacks,children:[(()=>{const v=new Date(u,l+1,0).getDate();let b=0;for(let e=0;e<l;++e)b+=new Date(u,e+1,0).getDate();const C=[];for(let e=1;e<=v;++e){const $=b+(e-1),a=new Date(u,l,e),K=new Date(Date.UTC(u,l,e)).toISOString().slice(0,10),tt=a.toLocaleDateString("de-DE",{weekday:"short"});C.push({date:K,weekday:tt,day:e,dayOfYear:$})}const s=(e,$)=>{const a=new Date(e+"T00:00:00Z"),K=new Date($+"T00:00:00Z");return(Math.floor((K.getTime()-a.getTime())/(1e3*60*60*24))%21+21)%21},j=C.filter(e=>{if(Ft.has(e.date))return!1;const $=Ot&&Ot.length>0?Ot:[];let a=$[0];for(const tt of $)if(tt.startDate<=e.date)a=tt;else break;const K=s(a.startDate,e.date);return(a&&a.pattern?a.pattern:[])[K]==="IW"}),m=new Set;try{const e=Array.from(new Set([...Object.keys(R||{}),...Object.keys(r||{})]));for(const $ of e){const a=R?.[$]||r?.[$]||{};for(const K of Object.keys(a)){const tt=a[K];if(!tt||!tt.type||typeof tt.type!="string"||!/^itw_/.test(tt.type))continue;const L=new Date(K+"T00:00:00Z");L.getUTCFullYear()===u&&L.getUTCMonth()===l&&(Ft.has(K)||m.add(K))}}}catch{}const d=Array.from(se||[]),x=new Map;for(const e of j)x.set(e.date,e);for(const e of m)if(!x.has(e)){const a=new Date(u,l,Number(e.slice(8,10))).toLocaleDateString("de-DE",{weekday:"short"});x.set(e,{date:e,weekday:a,day:Number(e.slice(8,10)),dayOfYear:0})}for(const e of d)if(!x.has(e)){const a=new Date(u,l,Number(e.slice(8,10))).toLocaleDateString("de-DE",{weekday:"short"});x.set(e,{date:e,weekday:a,day:Number(e.slice(8,10)),dayOfYear:0})}const i=Array.from(x.values()).sort((e,$)=>e.date.localeCompare($.date)),h=(e,$)=>{const a=Vt(e,$);return!!a&&q[a]==="itw"},M=(e,$)=>{const a=$===1?"itw_row_1":$===2?"itw_row_2":$===3?"itw_row_3":"itw_row_4",K=Bt(e,a);let tt=[];if($===1||$===2?tt=w.filter(L=>{const yt=`p_${L.id}`,kt=$===1?!!L.fahrzeugfuehrer:!0,Yt=h(yt,e);return kt&&Yt}).map(L=>({value:`p:${L.id}`,label:`${L.name}`})):$===3?tt=A.filter(L=>gt(Vt(`a_${L.id}`,e),"any")).map(L=>({value:`a:${L.id}`,label:`${L.name}`})):$===4&&(tt=(O||[]).map(L=>({value:`d:${L.id}`,label:L.name}))),K&&!tt.some(L=>L.value===K)){const L=vt(K);tt=[{value:K,label:L},...tt]}return t.jsxs("select",{className:y.select,value:K,onChange:L=>{const yt=L.target.value;yt===""?(L.preventDefault(),L.stopPropagation(),L.currentTarget.blur(),Ut(a,e)):xt(e,0,yt,a)},onKeyDown:L=>{(L.key==="Backspace"||L.key==="Delete")&&(L.preventDefault(),L.stopPropagation(),L.currentTarget.blur(),Ut(a,e))},children:[t.jsx("option",{value:""}),tt.map(L=>t.jsx("option",{value:L.value,children:L.label},L.value))]})},G=[];for(let e=0;e<i.length;e+=15)G.push(i.slice(e,e+15));return G.map((e,$)=>t.jsx("div",{className:y.itwRack,children:e.map(a=>{const tt=new Date(a.date+"T00:00:00Z").toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"});return t.jsxs("div",{className:y.itwCardWrap,children:[t.jsxs("div",{className:y.itwCardHeader,children:[tt," ",t.jsxs("small",{style:{fontWeight:400,color:"var(--muted)"},children:["(",a.weekday,")"]})]}),t.jsx("div",{className:y.itwDivider}),t.jsxs("div",{className:y.itwCard,children:[t.jsxs("div",{className:y.itwRow,children:[t.jsx("div",{className:y.itwRoleLabel,children:"FzF"}),M(a.date,1)]}),t.jsxs("div",{className:y.itwRow,children:[t.jsx("div",{className:y.itwRoleLabel,children:"Ma"}),M(a.date,2)]}),t.jsxs("div",{className:y.itwRow,children:[t.jsx("div",{className:y.itwRoleLabel,children:"Azubi"}),M(a.date,3)]}),t.jsxs("div",{className:y.itwRow,children:[t.jsx("div",{className:y.itwRoleLabel,children:"Arzt"}),M(a.date,4)]})]})]},`itw_card_${a.date}`)})},`itw_rack_${$}`))})(),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:10},children:[t.jsx("label",{style:{fontSize:13,color:"#555"},children:"Zusatz-Tag:"}),t.jsx("input",{type:"date",value:Rt,onChange:v=>Xt(v.target.value)}),t.jsx("button",{onClick:()=>{if(!Rt)return;const v=new Date(Rt+"T00:00:00Z");v.getUTCFullYear()!==u||v.getUTCMonth()!==l||Ft.has(Rt)||Qt(b=>new Set([...Array.from(b),Rt]))},children:"Tag hinzufügen"}),t.jsx("span",{style:{fontSize:12,color:"#666"},children:"Für Ersatzbesetzungen außerhalb der IW-Folge."})]})]})}),(()=>{const v=new Date(u,l+1,0).getDate(),b=[];for(let n=1;n<=v;n++)b.push(new Date(Date.UTC(u,l,n)).toISOString().slice(0,10));const C=(()=>{let n=0;for(let c=1;c<=v;c++){const o=new Date(Date.UTC(u,l,c)).toISOString().slice(0,10),f=[...I||[]].sort((it,ft)=>it.startDate.localeCompare(ft.startDate));let g=f[0];for(const it of f)if(it.startDate<=o)g=it;else break;const z=new Date((g?.startDate||"1970-01-01")+"T00:00:00Z"),E=new Date(o+"T00:00:00Z"),D=Math.floor((E.getTime()-z.getTime())/(1e3*60*60*24)),Y=g?.pattern||[],V=Y.length?Y[(D%21+21)%21]:"";V&&String(st)===V&&n++}return n})(),s=(rt||[]).filter(n=>(It[n.id]??Array(12).fill(!0))[l]!==!1).length,j=(wt||[]).filter(n=>(Ct[n.id]??Array(12).fill(!0))[l]!==!1).length,m=(()=>{let n=0;const c=Array.from(new Set([...Object.keys(R||{}),...Object.keys(r||{})]));for(const o of c)for(const f of b){const g=R?.[o]?.[f]||r?.[o]?.[f];if(!g)continue;const z=String(g.type||""),E=String(g.value||"").trim();(z.startsWith("itw_")||E&&q[E]==="itw")&&n++}return n})(),d=(()=>{let n=0;const c=/^rtw\d+_(tag|nacht)_2$/;for(const o of A||[]){const f=`a_${o.id}`;for(const g of b){const z=String((R?.[f]?.[g]||r?.[f]?.[g])?.type||"");c.test(z)&&n++}}return n})(),x=Math.max(0,C*(s*4+j*2)+m-d),i=(()=>{const n=new Set;for(const c of w||[]){const o=`p_${c.id}`;for(const f of b){const g=String((R?.[o]?.[f]||r?.[o]?.[f])?.value||"").trim();if(g&&(q[g]||"off")!=="off"){n.add(o);break}}}return n.size})(),h=i>0?x/i:0,M=(()=>{const n={};for(const c of w||[]){const o=`p_${c.id}`;let f=0,g=0;for(const z of b){const E=R?.[o]?.[z]||r?.[o]?.[z],D=String(E?.value||"").trim();D&&q[D]==="24h"&&f++,(String(E?.type||"").startsWith("itw_")||D&&q[D]==="itw")&&g++}n[o]=f+g}return n})(),G=(()=>{const n=Object.values(M).filter(o=>o>0);if(n.length===0)return 0;const c=n.reduce((o,f)=>o+f,0);return Math.round(c/n.length)})(),e={},$={},a={},K={};for(const n of w||[]){const c=`p_${n.id}`;let o=0,f=0,g=0,z=0,E=0;for(const D of b){const Y=R?.[c]?.[D]||r?.[c]?.[D],V=String(Y?.type||"");/^rtw\d+_(tag|nacht)_(1|2)$/.test(V)&&(o+=1),/^rtw\d+_tag_(1|2)$/.test(V)&&(f+=1),/^rtw\d+_nacht_(1|2)$/.test(V)?g+=1:/^itw_row_[12]$/.test(V)?o+=1:/^nef(\d+)?_assist$/.test(V)&&(o+=2),/^itw_row_[12]$/.test(V)&&(E+=1),/^nef(\d+)?_assist$/.test(V)&&(z+=2)}e[c]=o,$[c]={tag:f,nacht:g},a[c]=z,K[c]=E}const tt=n=>{const c=new Date(u,n+1,0).getDate(),o=[];for(let _=1;_<=c;_++)o.push(new Date(Date.UTC(u,n,_)).toISOString().slice(0,10));const f=(()=>{let _=0;for(let H=1;H<=c;H++){const F=new Date(Date.UTC(u,n,H)).toISOString().slice(0,10),B=[...I||[]].sort((Dt,Zt)=>Dt.startDate.localeCompare(Zt.startDate));let U=B[0];for(const Dt of B)if(Dt.startDate<=F)U=Dt;else break;const at=new Date((U?.startDate||"1970-01-01")+"T00:00:00Z"),ut=new Date(F+"T00:00:00Z"),pt=Math.floor((ut.getTime()-at.getTime())/(1e3*60*60*24)),Nt=U?.pattern||[],Pt=Nt.length?Nt[(pt%21+21)%21]:"";Pt&&String(st)===Pt&&_++}return _})(),g=(rt||[]).filter(_=>(It[_.id]??Array(12).fill(!0))[n]!==!1).length,z=(wt||[]).filter(_=>(Ct[_.id]??Array(12).fill(!0))[n]!==!1).length,E=(()=>{let _=0;const H=Array.from(new Set([...Object.keys(R||{}),...Object.keys(r||{})]));for(const F of H)for(const B of o){const U=R?.[F]?.[B]||r?.[F]?.[B];if(!U)continue;const at=String(U.type||""),ut=String(U.value||"").trim();(at.startsWith("itw_")||ut&&q[ut]==="itw")&&_++}return _})(),D=(()=>{let _=0;const H=/^rtw\d+_(tag|nacht)_2$/;for(const F of A||[]){const B=`a_${F.id}`;for(const U of o){const at=String((R?.[B]?.[U]||r?.[B]?.[U])?.type||"");H.test(at)&&_++}}return _})(),Y=Math.max(0,f*(g*4+z*2)+E-D),V=(()=>{const _=new Set;for(const H of w||[]){const F=`p_${H.id}`;for(const B of o){const U=String((R?.[F]?.[B]||r?.[F]?.[B])?.value||"").trim();if(U&&(q[U]||"off")!=="off"){_.add(F);break}}}return _.size})(),it=V>0?Y/V:0,ft=(()=>{const _={};for(const H of w||[]){const F=`p_${H.id}`;let B=0,U=0;for(const at of o){const ut=R?.[F]?.[at]||r?.[F]?.[at],pt=String(ut?.value||"").trim();pt&&q[pt]==="24h"&&B++,(String(ut?.type||"").startsWith("itw_")||pt&&q[pt]==="itw")&&U++}_[F]=B+U}return _})(),Mt=(()=>{const _=Object.values(ft).filter(F=>F>0);if(_.length===0)return 0;const H=_.reduce((F,B)=>F+B,0);return Math.round(H/_.length)})(),jt={};for(const _ of w||[]){const H=`p_${_.id}`,F=ft[H]||0,B=Mt,U=it,at=B>0&&U>0&&F>0?Math.round(U/B*F):0;jt[H]=at}return jt},L={};for(let n=0;n<12;n++){const c=tt(n);for(const[o,f]of Object.entries(c))L[o]=(L[o]||0)+(f||0)}const yt={};for(const n of w||[]){const c=`p_${n.id}`;let o=0;for(let f=0;f<12;f++){const g=new Date(u,f+1,0).getDate();for(let z=1;z<=g;z++){const E=new Date(Date.UTC(u,f,z)).toISOString().slice(0,10),D=R?.[c]?.[E]||r?.[c]?.[E],Y=String(D?.type||"");/^rtw\d+_(tag|nacht)_(1|2)$/.test(Y)||/^itw_row_[12]$/.test(Y)?o+=1:/^nef(\d+)?_assist$/.test(Y)&&(o+=2)}}yt[c]=o}const kt=(w||[]).map(n=>{const c=`p_${n.id}`,o=M[c]||0,f=G,g=h,z=f>0&&g>0&&o>0?Math.round(g/f*o):"",E=e[c]||0,D=$[c]||{tag:0,nacht:0},Y=a[c]||0,V=K[c]||0,it=(()=>{const Mt=L[c]||0,jt=yt[c]||0;return Mt-jt})(),ft=Number(n.teilzeit??100)||100;return{name:n.name,target:z,count:E,tag:D.tag,nacht:D.nacht,nef:Y,itw:V,rest:it,teilzeit:ft}}),St=kt.map((n,c)=>({...n,idx:c})).filter(n=>typeof n.target=="number"&&n.target>0).map(n=>{const c=Math.max(.01,(n.teilzeit||100)/100);return n.rest/c}),At=St.length?Math.min(...St):0,zt=St.length?Math.max(...St):0,Ht=n=>{const o=(D=>Math.max(0,Math.min(1,D)))(n),f=(D,Y,V)=>D+(Y-D)*V,g=Math.round(f(34,239,o)),z=Math.round(f(197,68,o)),E=Math.round(f(94,68,o));return{r:g,g:z,b:E}};return t.jsxs("aside",{className:y.sidebar,children:[t.jsx("div",{className:y.sidebarTitle,children:"Kontrolle"}),t.jsx("div",{className:y.sidebarSub}),t.jsxs("div",{className:y.sidebarList,children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto auto auto auto",alignItems:"center",gap:8,fontWeight:600,fontSize:12,color:"#374151",marginBottom:4},children:[t.jsx("span",{}),t.jsx("span",{style:{textAlign:"center"},children:"Soll | Ist"}),t.jsx("span",{style:{textAlign:"center"},children:"NEF"}),t.jsx("span",{style:{textAlign:"center"},children:"ITW"}),t.jsx("span",{style:{textAlign:"center"},children:"Gesamt"}),t.jsx("span",{})]}),kt.map((n,c)=>{const o=typeof n.target=="number"&&n.target>0;let f;if(o&&zt>At){const g=Math.max(.01,(n.teilzeit||100)/100),E=(n.rest/g-At)/(zt-At),D=Ht(E),Y=`rgba(${D.r}, ${D.g}, ${D.b}, 0.18)`,V=`1px solid rgba(${D.r}, ${D.g}, ${D.b}, 0.35)`;f={background:Y,borderRadius:4,border:V,padding:"0 6px"}}return t.jsxs("div",{className:y.sidebarItem,style:{display:"grid",gridTemplateColumns:"1fr auto auto auto auto auto",alignItems:"center",gap:8},children:[t.jsx("span",{className:y.sidebarName,children:n.name}),t.jsx("span",{className:y.sidebarVal,children:(n.target===""?"–":n.target)+" | "+n.count}),t.jsx("span",{className:y.sidebarVal,children:n.nef}),t.jsx("span",{className:y.sidebarVal,children:n.itw}),t.jsx("span",{className:y.sidebarVal,style:f,children:Number.isFinite(n.rest)?n.rest:"–"}),t.jsxs("div",{style:{gridColumn:"1 / span 6",display:"flex",alignItems:"center",gap:6},children:[t.jsx("div",{style:{fontSize:10,color:"#4b5563",minWidth:56},children:`T:${n.tag} / N:${n.nacht}`}),t.jsxs("div",{style:{position:"relative",width:100,height:8,background:"#eef2f7",borderRadius:4},children:[t.jsx("div",{style:{position:"absolute",left:"50%",top:0,bottom:0,width:1,background:"#cbd5e1"}}),(()=>{const g=(n.tag||0)+(n.nacht||0),z=g>0?Math.min(1,(n.nacht||0)/g):0,E=g>0?Math.min(1,(n.tag||0)/g):0;return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"absolute",right:"50%",width:`${z*50}%`,top:0,bottom:0,background:"#60a5fa",borderTopLeftRadius:4,borderBottomLeftRadius:4}}),t.jsx("div",{style:{position:"absolute",left:"50%",width:`${E*50}%`,top:0,bottom:0,background:"#fb923c",borderTopRightRadius:4,borderBottomRightRadius:4}})]})})()]})]})]},c)})]})]})})()]})]})},rn=()=>{const[l,S]=p.useState(new Date().getMonth()),[w,A]=p.useState(new Date().getFullYear()),[r,u]=p.useState([]),[P,I]=p.useState([]),[W,Z]=p.useState({}),[st,et]=p.useState([]),R=p.useCallback(async()=>{try{const X=await window.api.getSetting("year");A(Number(X||new Date().getFullYear()))}catch{}try{const X=await window.api.getPersonnelList();u(X||[])}catch{}try{const X=await window.api.getAzubiList();I(X||[])}catch{}try{const X=await window.api.getDeptPatterns?.(),ct=(ot,nt=21)=>(ot||[]).slice(0,nt).concat(Array(nt).fill("")).slice(0,nt).map(q=>q==="1"||q==="2"||q==="3"?q:""),dt=(X||[]).map(ot=>({startDate:String(ot.startDate),pattern:ct(String(ot.pattern||"").split(",").map(nt=>nt.trim()),21)}));dt.sort((ot,nt)=>ot.startDate.localeCompare(nt.startDate)),et(dt)}catch{}},[]),lt=p.useCallback(async X=>{try{const ct=typeof X=="number"?X:Number(await window.api.getSetting("year")||new Date().getFullYear()),dt=await window.api.getDutyRoster(ct),ot={};(dt||[]).forEach(nt=>{if(!nt||!nt.date)return;const q=`${nt.personType==="azubi"?"a_":"p_"}${nt.personId}`;ot[q]||(ot[q]={}),ot[q][String(nt.date)]={value:nt.value,type:nt.type}}),Z(ot)}catch{}},[]);p.useEffect(()=>{R().then(()=>lt());const X=async()=>{await R(),await lt()},ct=async()=>{await lt()},dt=async()=>{await R(),await lt()};return window.api?.onSettingsUpdated?.(X),window.api?.onDutyRosterUpdated?.(ct),window.api?.onPersonnelUpdated?.(dt),()=>{window.api?.offSettingsUpdated?.(X),window.api?.offDutyRosterUpdated?.(ct),window.api?.offPersonnelUpdated?.(dt)}},[R,lt]);const rt=X=>S(X),_t=async()=>{await lt(w)},wt=(X,ct,dt,ot)=>{Z(nt=>({...nt,[X]:{...nt[X]||{},[ct]:{value:dt,type:ot}}}))};return t.jsx("div",{style:{padding:8},children:t.jsx(on,{currentMonth:l,onMonthChange:rt,personnel:r,azubis:P,roster:W,year:w,shiftPattern:[],deptPatternSeqs:st,onRosterChanged:_t,onEntryAssigned:wt})})},cn=()=>{const[l]=p.useState(new Date().getMonth()),[S,w]=p.useState(""),[A,r]=p.useState(1),[u,P]=p.useState(new Date().getFullYear()),[I,W]=p.useState("einteilung");async function Z(){try{const et=await window.api.getSetting("rescueStation");et!=null&&w(String(et))}catch{}try{const et=await window.api.getSetting("department");et!=null&&r(Number(et))}catch{}try{const et=await window.api.getSetting("year");et!=null&&P(Number(et))}catch{}}p.useEffect(()=>{Z()},[]),p.useEffect(()=>{const et=R=>{const rt=R.detail?.view||"";["einteilung","dienstplan","werte","personal","fahrzeuge","einstellungen"].includes(rt)&&W(rt)};return window.addEventListener("navigate",et),window.api?.onNavigate?.(R=>{typeof R=="string"&&["einteilung","dienstplan","werte","personal","fahrzeuge","einstellungen"].includes(R)?W(R):R&&typeof R.view=="string"&&["einteilung","dienstplan","werte","personal","fahrzeuge","einstellungen"].includes(R.view)&&W(R.view)}),()=>{window.api?.offNavigate?.(),window.removeEventListener("navigate",et)}},[]),p.useEffect(()=>{const et=async()=>{try{await Z()}catch{}};return window.api?.onSettingsUpdated?.(et),()=>window.api?.offSettingsUpdated?.(et)},[]);const st=p.useMemo(()=>{switch(I){case"einteilung":return t.jsx(rn,{});case"dienstplan":return t.jsx(ie,{});case"werte":return t.jsx(Ae,{});case"personal":return t.jsx(re,{});case"fahrzeuge":return t.jsx(ce,{});case"einstellungen":return t.jsx("div",{style:{padding:16},children:t.jsx(le,{onClose:()=>W("dienstplan")})});default:return null}},[I]);return t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto 1fr auto",height:"100vh"},children:[t.jsx("div",{style:{gridRow:1,gridColumn:"1 / span 2"},children:t.jsx(de,{rescueStation:S,department:A,year:u})}),t.jsx("div",{style:{gridRow:2,gridColumn:1},children:t.jsx(fe,{active:I})}),t.jsx("main",{style:{gridRow:2,gridColumn:2,overflow:"auto"},children:st}),t.jsx("div",{style:{gridRow:3,gridColumn:2},children:t.jsx(ue,{})})]})},ne=document.getElementById("app");ne&&oe.createRoot(ne).render(t.jsx(cn,{}));
