import{j as e}from"./client-nyetWBf2.js";import{r as d,R as ce}from"./index-DOOLV48n.js";import{s as f}from"./PersonnelOverview.module-S9DstIlR.js";const Ae=T=>{const D=[],w=new Date(T,0,1),l=new Date(T+1,0,1);for(let h=new Date(w);h<l;h.setDate(h.getDate()+1)){const I=new Date(Date.UTC(h.getFullYear(),h.getMonth(),h.getDate())).toISOString().slice(0,10),C=h.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"}),j=h.toLocaleDateString("de-DE",{weekday:"short"});D.push({iso:I,date:C,weekday:j})}return D},Fe=({year:T,personnel:D,onCancel:w,onImport:l})=>{const h=Ae(T),[I,C]=d.useState(D.map(()=>Array(h.length).fill(""))),[j,E]=d.useState(null),k=d.useRef(null);return d.useEffect(()=>{const x=m=>{if(!k.current||document.activeElement?.tagName==="INPUT")return;const $=m.clipboardData?.getData("text");if(!$)return;const s=$.split(/\r?\n/).filter(Boolean).map(b=>b.split(/\t/));s.length!==0&&C(b=>{const S=b.map(v=>[...v]),N=j?j.row:0,z=j?j.col:0;for(let v=0;v<s.length&&v+N<S.length;v++)for(let P=0;P<s[v].length&&P+z<S[v+N].length;P++)S[v+N][P+z]=s[v][P];return S})};return document.addEventListener("paste",x),()=>document.removeEventListener("paste",x)},[j]),e.jsxs("div",{style:{background:"#fff",border:"1px solid #ccc",borderRadius:8,padding:24,maxWidth:"95vw",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{children:["Jahres-Dienstplan-Import ",T]}),e.jsx("p",{style:{marginTop:0,color:"#555",fontSize:14},children:"Füge (Copy & Paste) aus Excel ein. Jede Zeile = Person/Azubi, jede Spalte = Tag (MM.TT). Scrollbar für viele Tage."}),e.jsxs("table",{ref:k,style:{borderCollapse:"collapse"},children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{position:"sticky",left:0,top:0,background:"#fff",zIndex:3,border:"1px solid #ccc"},children:"Name"}),h.map((x,m)=>e.jsx("th",{style:{border:"1px solid #ccc",fontSize:11},children:x.date},m))]}),e.jsxs("tr",{children:[e.jsx("th",{style:{position:"sticky",left:0,top:24,background:"#fff",zIndex:3,border:"1px solid #ccc"},children:" "}),h.map((x,m)=>e.jsx("th",{style:{border:"1px solid #ccc",fontSize:11},children:x.weekday},m))]})]}),e.jsx("tbody",{children:D.map((x,m)=>[x.isAzubi&&(m===0||!D[m-1].isAzubi)?e.jsx("tr",{children:e.jsx("td",{colSpan:h.length+1,style:{background:"#e3f2fd",fontWeight:"bold",color:"#1976d2",borderTop:"2px solid #1976d2",borderBottom:"2px solid #1976d2",textAlign:"left"},children:"Azubis"})},`sep_${x.id}`):null,e.jsxs("tr",{style:{background:m%2===1?"#f8f9fb":void 0},children:[e.jsxs("td",{style:{position:"sticky",left:0,background:"#fff",zIndex:2,border:"1px solid #ccc",fontStyle:x.isAzubi?"italic":void 0},children:[x.name,x.isAzubi&&x.lehrjahr?` (Azubi, ${x.lehrjahr}. Lj.)`:""]}),h.map((s,b)=>e.jsx("td",{style:{minWidth:70,border:"1px solid #ccc",cursor:"pointer",background:j&&j.row===m&&j.col===b?"#e3f2fd":void 0},onClick:()=>E({row:m,col:b}),children:e.jsx("div",{contentEditable:!0,suppressContentEditableWarning:!0,style:{outline:"none",minWidth:60,minHeight:20,textAlign:"center"},onInput:S=>{const N=S.target.innerText;C(z=>{const v=z.map(P=>[...P]);return v[m][b]=N,v})},onPaste:S=>{S.preventDefault()},children:I[m][b]})},b))]},x.id)])})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx("button",{onClick:()=>l(I),style:{marginRight:12},children:"Importieren"}),e.jsx("button",{onClick:w,children:"Abbrechen"})]}),e.jsxs("div",{style:{marginTop:12,color:"#555",fontSize:14},children:[e.jsx("b",{children:"Tipp:"})," Kompletten Jahresplan aus Excel markieren (ohne Überschriften) und hier einfügen (Cmd+V / Strg+V)."]})]})},ze=({onImportComplete:T,onClose:D})=>{const[w,l]=d.useState(!1),[h,I]=d.useState(null),[C,j]=d.useState(!1),E=async()=>{try{const s=await window.electronAPI.invoke("show-open-dialog",{title:"JSON-Datei für Einstellungs-Import auswählen",filters:[{name:"JSON-Dateien",extensions:["json"]},{name:"Alle Dateien",extensions:["*"]}],properties:["openFile"]});if(s.canceled||!s.filePaths?.length)return;const b=s.filePaths[0];l(!0),I(null);const S=await window.electronAPI.invoke("import-settings-json",b,C);I(S),l(!1),T&&T(S)}catch(s){console.error("Settings Import-Fehler:",s),I({success:!1,imported:{settings:0,shiftTypes:0,holidays:0,itwPatterns:0,deptPatterns:0,rtwVehicles:0,nefVehicles:0},skipped:0,errors:[`Import fehlgeschlagen: ${s instanceof Error?s.message:String(s)}`]}),l(!1)}},k=async()=>{try{const s=await window.electronAPI.invoke("show-save-dialog",{title:"Einstellungen als JSON exportieren",defaultPath:`RD-Plan-Einstellungen-${new Date().toISOString().slice(0,10)}.json`,filters:[{name:"JSON-Dateien",extensions:["json"]},{name:"Alle Dateien",extensions:["*"]}]});if(s.canceled||!s.filePath)return;l(!0),await window.electronAPI.invoke("export-settings-json",s.filePath),l(!1),alert("JSON-Export erfolgreich abgeschlossen!")}catch(s){console.error("Settings Export-Fehler:",s),l(!1),alert(`JSON-Export fehlgeschlagen: ${s instanceof Error?s.message:String(s)}`)}},x=async()=>{try{const s=await window.electronAPI.invoke("show-save-dialog",{title:"Einstellungen als Excel exportieren",defaultPath:`RD-Plan-Einstellungen-${new Date().toISOString().slice(0,10)}.xlsx`,filters:[{name:"Excel-Dateien",extensions:["xlsx"]},{name:"Alle Dateien",extensions:["*"]}]});if(s.canceled||!s.filePath)return;l(!0),await window.electronAPI.invoke("export-settings-excel",s.filePath),l(!1),alert("Excel-Export erfolgreich abgeschlossen!")}catch(s){console.error("Settings Export-Fehler:",s),l(!1),alert(`Excel-Export fehlgeschlagen: ${s instanceof Error?s.message:String(s)}`)}},m=async()=>{try{const s=await window.electronAPI.invoke("show-save-dialog",{title:"Einstellungs-Vorlage erstellen",defaultPath:"RD-Plan-Einstellungen-Vorlage.json",filters:[{name:"JSON-Dateien",extensions:["json"]},{name:"Excel-Dateien",extensions:["xlsx"]},{name:"Alle Dateien",extensions:["*"]}]});if(s.canceled||!s.filePath)return;l(!0),await window.electronAPI.invoke("create-settings-template",s.filePath),l(!1),alert("Vorlage erfolgreich erstellt!")}catch(s){console.error("Template-Fehler:",s),l(!1),alert(`Vorlage-Erstellung fehlgeschlagen: ${s instanceof Error?s.message:String(s)}`)}},$=s=>s.imported.settings+s.imported.shiftTypes+s.imported.holidays+s.imported.itwPatterns+s.imported.deptPatterns+s.imported.rtwVehicles+s.imported.nefVehicles;return e.jsxs("div",{className:"settings-import-export-container",style:{padding:"20px",maxWidth:"700px"},children:[e.jsx("h2",{children:"Einstellungen Import/Export"}),e.jsxs("div",{className:"import-section",style:{marginBottom:"30px"},children:[e.jsx("h3",{children:"Import aus JSON"}),e.jsx("p",{children:"Importiere alle Einstellungen (Schichtarten, Fahrzeuge, Feiertage, etc.) aus einer JSON-Datei."}),e.jsx("div",{style:{marginBottom:"10px"},children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:C,onChange:s=>j(s.target.checked),disabled:w}),e.jsx("span",{style:{marginLeft:"8px"},children:"Bestehende Einstellungen ersetzen (Vorsicht: Alle aktuellen Einstellungen werden überschrieben!)"})]})}),e.jsx("div",{style:{marginBottom:"10px"},children:e.jsx("button",{onClick:E,disabled:w,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:w?"not-allowed":"pointer"},children:w?"Importiere...":"JSON-Datei importieren"})}),h&&e.jsxs("div",{className:"import-result",style:{padding:"10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:h.success?"#d4edda":"#f8d7da",color:h.success?"#155724":"#721c24"},children:[e.jsx("h4",{children:"Import-Ergebnis:"}),e.jsxs("p",{children:["Status: ",h.success?"Erfolgreich":"Fehlerhaft"]}),e.jsxs("p",{children:["Gesamt importiert: ",$(h)]}),e.jsxs("p",{children:["Übersprungen: ",h.skipped]}),e.jsxs("details",{style:{marginTop:"10px"},children:[e.jsx("summary",{children:"Details anzeigen"}),e.jsxs("ul",{style:{marginTop:"5px"},children:[e.jsxs("li",{children:["Einstellungen: ",h.imported.settings]}),e.jsxs("li",{children:["Schichtarten: ",h.imported.shiftTypes]}),e.jsxs("li",{children:["Feiertage: ",h.imported.holidays]}),e.jsxs("li",{children:["ITW-Schichtfolgen: ",h.imported.itwPatterns]}),e.jsxs("li",{children:["Abteilungs-Schichtfolgen: ",h.imported.deptPatterns]}),e.jsxs("li",{children:["RTW-Fahrzeuge: ",h.imported.rtwVehicles]}),e.jsxs("li",{children:["NEF-Fahrzeuge: ",h.imported.nefVehicles]})]})]}),h.errors.length>0&&e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx("p",{children:"Fehler:"}),e.jsx("ul",{children:h.errors.map((s,b)=>e.jsx("li",{children:s},b))})]})]})]}),e.jsxs("div",{className:"export-section",style:{marginBottom:"30px"},children:[e.jsx("h3",{children:"Export"}),e.jsx("p",{children:"Exportiere aktuelle Einstellungen für Backup oder Transfer zu anderen Installationen."}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:k,disabled:w,style:{padding:"10px 20px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:w?"not-allowed":"pointer"},children:w?"Exportiere...":"Als JSON exportieren"}),e.jsx("button",{onClick:x,disabled:w,style:{padding:"10px 20px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",cursor:w?"not-allowed":"pointer"},children:w?"Exportiere...":"Als Excel exportieren"})]})]}),e.jsxs("div",{className:"template-section",style:{marginBottom:"30px"},children:[e.jsx("h3",{children:"Vorlage erstellen"}),e.jsx("p",{children:"Erstelle eine Vorlage mit Beispiel-Einstellungen für neue Installationen."}),e.jsx("button",{onClick:m,disabled:w,style:{padding:"10px 20px",backgroundColor:"#ffc107",color:"#212529",border:"none",borderRadius:"4px",cursor:w?"not-allowed":"pointer"},children:w?"Erstelle...":"Vorlage erstellen"})]}),e.jsxs("div",{className:"info-section",style:{backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"4px"},children:[e.jsx("h4",{children:"Exportierte Daten:"}),e.jsx("p",{children:"Die Export-Datei enthält folgende Einstellungen:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Allgemeine Einstellungen:"})," Rettungswache, Jahr, Abteilung, etc."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Schichtarten:"})," Kürzel, Beschreibungen, Farben"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Feiertage:"})," Alle gespeicherten Feiertage"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ITW-Schichtfolgen:"})," Schichtmuster für ITW-Dienste"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Abteilungs-Schichtfolgen:"})," Schichtmuster für Abteilungen"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Fahrzeuge:"})," RTW und NEF Konfigurationen"]})]}),e.jsx("p",{children:e.jsx("em",{children:"Personal-Daten und Dienstpläne werden NICHT exportiert."})})]}),D&&e.jsx("div",{style:{marginTop:"20px",textAlign:"right"},children:e.jsx("button",{onClick:D,style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Schließen"})})]})},fe={version:"0.1",build:212},Ye=({onClose:T})=>{const[D,w]=d.useState("1"),[l,h]=d.useState(new Date().getFullYear()),[I,C]=d.useState(!0),[j,E]=d.useState(!1),[k,x]=d.useState([]),[m,$]=d.useState(!0),[s,b]=d.useState(null),[S,N]=d.useState(!1),[z,v]=d.useState(null),[P,de]=d.useState(1),[J,ne]=d.useState({}),[A,ie]=d.useState({}),[R,W]=d.useState([]),[L,U]=d.useState(!1),[he,G]=d.useState(null),[B,Z]=d.useState(null),[O,Y]=d.useState([]),[H,Q]=d.useState(!1),[pe,X]=d.useState(null),[M,ee]=d.useState(null),[_,F]=d.useState([]),[V,te]=d.useState(!1),[ge,se]=d.useState(null),[q,K]=d.useState(null),[me,re]=d.useState(!1),[we,ae]=d.useState(null),[ye,le]=d.useState(null),[je,ue]=d.useState(!1);d.useEffect(()=>{(async()=>{const t=await window.api.getSetting("rescueStation");if(t){const r=String(t);w(["1","2","3","4","5"].includes(r)?r:"1")}const n=await window.api.getSetting("year");n&&h(Number(n));const i=await window.api.getShiftTypes();x(i);const p={},a={};for(const r of i){try{const c=await window.api.getSetting(`auswertung_${r.code}`);p[r.code]=c||"off"}catch{p[r.code]="off"}try{const c=await window.api.getSetting(`color_${r.code}`);a[r.code]=typeof c=="string"&&/^#?[0-9a-fA-F]{6}$/.test(c)?c.startsWith("#")?c:`#${c}`:""}catch{a[r.code]=""}}ne(p),ie(a);const o=await window.api.getSetting("department");o&&de(Number(o));try{const r=await window.api.getItwPatterns?.(),c=(u,g=21)=>(u||[]).slice(0,g).concat(Array(g).fill("")).slice(0,g).map(y=>y==="IW"?"IW":"");if(Array.isArray(r)&&r.length>0){const u=r.map(g=>({startDate:String(g.startDate),pattern:c(String(g.pattern).split(",").map(y=>y.trim()),21)}));u.sort((g,y)=>g.startDate.localeCompare(y.startDate)),W(u)}}catch{}try{const r=await window.api.getDeptPatterns?.(),c=(u,g=21)=>(u||[]).slice(0,g).concat(Array(g).fill("")).slice(0,g).map(y=>y==="1"||y==="2"||y==="3"?y:"");if(Array.isArray(r)&&r.length>0){const u=r.map(g=>({startDate:String(g.startDate),pattern:c(String(g.pattern).split(",").map(y=>y.trim()),21)}));u.sort((g,y)=>g.startDate.localeCompare(y.startDate)),Y(u)}}catch{}try{const r=await window.api.getHolidaysForYear?.(Number(n||new Date().getFullYear()));F((r||[]).map(c=>({date:String(c.date),name:String(c.name||"")})))}catch{}$(!1),C(!1)})()},[]);const be=async()=>{E(!0),await window.api.setSetting("rescueStation",D),await window.api.setSetting("year",String(l)),await window.api.setSetting("department",String(P));for(const t of Object.keys(J))await window.api.setSetting(`auswertung_${t}`,J[t]);for(const t of Object.keys(A)){const n=A[t]||"",i=n?n.startsWith("#")?n:`#${n}`:"";await window.api.setSetting(`color_${t}`,i)}try{const t=(R||[]).map(n=>({startDate:n.startDate,pattern:(n.pattern||[]).map(i=>i==="IW"?"IW":"").join(",")}));await window.api.setItwPatterns?.(t)}catch{}try{const t=(O||[]).map(n=>({startDate:n.startDate,pattern:(n.pattern||[]).map(i=>i==="1"||i==="2"||i==="3"?i:"").join(",")}));await window.api.setDeptPatterns?.(t)}catch{}try{await window.api.setHolidaysForYear?.(l,_.map(t=>({date:t.date,name:t.name})));try{const t=await window.api.getHolidaysForYear?.(l);F((t||[]).map(n=>({date:String(n.date),name:String(n.name||"")})))}catch{}}catch{}E(!1),T()},Se=async t=>{const n=t||we;if(n)try{if(!window.confirm(`Alle Einträge im Dienstplan für das Jahr ${l} werden überschrieben. Fortfahren?`))return;const p=await window.api.getPersonnelList(),a=await window.api.getAzubiList(),o=[...p.map(u=>({id:`p_${u.id}`,origId:u.id,type:"person"})),...a.map(u=>({id:`a_${u.id}`,origId:u.id,type:"azubi"}))],r=[];for(let u=0;u<o.length;u++){const g=n[u];if(g)for(let y=0;y<g.length;y++){const oe=(g[y]||"").trim();if(!oe)continue;const xe=new Date(Date.UTC(l,0,1+y));if(xe.getUTCFullYear()!==l)continue;const Ee=xe.toISOString().slice(0,10),Ne=k.some(Pe=>Pe.code===oe)?"dropdown":"text";r.push({personId:o[u].origId,personType:o[u].type,date:Ee,value:oe,type:Ne})}}const c=(u,g)=>{le(g)};window.api.onBulkImportProgress(c),await window.api.clearDutyRosterYear(l),await window.api.bulkSetDutyRoster(r),window.api.offBulkImportProgress(c),re(!1),ae(null),le(null)}catch(i){console.warn("[SettingsMenu] applyYearImport Fehler",i)}};d.useEffect(()=>{(async()=>{try{const t=await window.api.getHolidaysForYear?.(l);F((t||[]).map(n=>({date:String(n.date),name:String(n.name||"")})))}catch{}})()},[l]);const ve=()=>{v(JSON.parse(JSON.stringify(k))),N(!0)},De=()=>{z&&x(z),v(null),N(!1)},Te=async()=>{try{const t=z||[],n={...J||{}},i={...A||{}};for(const a of k)if(a._isNew){if(!a.code.trim()||!a.description.trim())continue;await window.api.addShiftType({code:a.code,description:a.description});const o=n[a.code]||"off";try{await window.api.setSetting(`auswertung_${a.code}`,o)}catch{}try{await window.api.setSetting(`color_${a.code}`,i[a.code]||"")}catch{}}else{const o=t.find(r=>r.id===a.id);if(o&&(o.code!==a.code||o.description!==a.description)){const r=o.code,c=a.code;if(await window.api.updateShiftType({id:a.id,code:c,description:a.description}),r!==c){const u=n[r]||"off";n[c]=u,n[r]=n[r]??"off";try{await window.api.setSetting(`auswertung_${c}`,u)}catch{}try{await window.api.setSetting(`auswertung_${r}`,n[r])}catch{}const g=i[r]||"";i[c]=g,i[r]=i[r]??"";try{await window.api.setSetting(`color_${c}`,g||"")}catch{}try{await window.api.setSetting(`color_${r}`,i[r]||"")}catch{}}else{try{await window.api.setSetting(`auswertung_${c}`,n[c]||"off")}catch{}try{await window.api.setSetting(`color_${c}`,i[c]||"")}catch{}}}else if(o){try{await window.api.setSetting(`auswertung_${a.code}`,n[a.code]||"off")}catch{}try{await window.api.setSetting(`color_${a.code}`,i[a.code]||"")}catch{}}}N(!1),v(null);const p=await window.api.getShiftTypes();x(p)}catch(t){console.warn("[SettingsMenu] saveEditingShiftTypes Fehler",t)}},ke=()=>{N(!0),x(t=>[...t,{id:Math.floor(-Date.now()/1e3),code:"",description:"",_isNew:!0}])},Ie=async()=>{if(s==null)return;const t=k.find(n=>n.id===s);if(t){if(t._isNew){x(n=>n.filter(i=>i.id!==t.id)),b(null);return}await window.api.deleteShiftType(t.id),b(null),x(await window.api.getShiftTypes())}},Ce=t=>{if(console.log("Settings-Import abgeschlossen:",t),t.success){const n=t.imported.settings+t.imported.shiftTypes+t.imported.holidays+t.imported.itwPatterns+t.imported.deptPatterns+t.imported.rtwVehicles+t.imported.nefVehicles;alert(`Import erfolgreich! ${n} Einstellungen importiert, ${t.skipped} übersprungen.`),window.location.reload()}};return I?e.jsx("div",{className:"settings-menu",children:e.jsx("p",{children:"Lade Einstellungen ..."})}):e.jsxs("div",{className:"settings-menu",children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:[e.jsx("h2",{style:{margin:0},children:"Einstellungen"}),e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["Version ",fe.version," (Build ",fe.build,") — © Benjamin Kreitz"]})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap",marginTop:8},children:[e.jsxs("label",{children:["Jahr:",e.jsx("input",{type:"number",value:l,min:2020,max:2100,onChange:t=>h(Number(t.target.value)),style:{marginLeft:8,width:80}})]}),e.jsxs("label",{children:["Feuer- und Rettungswache:",e.jsxs("select",{value:D,onChange:t=>w(t.target.value),style:{marginLeft:8},children:[e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5"})]})]}),e.jsxs("label",{children:["Abteilung:",e.jsxs("select",{value:P,onChange:t=>de(Number(t.target.value)),style:{marginLeft:8},children:[e.jsx("option",{value:1,children:"1"}),e.jsx("option",{value:2,children:"2"}),e.jsx("option",{value:3,children:"3"})]})]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("button",{onClick:()=>re(!0),children:"Import Dienstplan…"}),e.jsx("span",{style:{marginLeft:8,fontSize:12,color:"#555"},children:"Bestehende Einträge werden für Tage mit Werten überschrieben."})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("button",{onClick:()=>ue(!0),style:{backgroundColor:"#17a2b8",color:"white"},children:"Einstellungen Import/Export…"}),e.jsx("span",{style:{marginLeft:8,fontSize:12,color:"#555"},children:"Backup und Transfer von Konfigurationen."})]}),e.jsxs("div",{style:{marginTop:24,borderTop:"1px solid #eee",paddingTop:12},children:[e.jsx("h3",{children:"ITW Schichtfolgen"}),e.jsx("p",{style:{marginTop:0,color:"#666"},children:"Pflege hier beliebig viele 21‑Tage‑Schichtfolgen, die ab einem Datum gelten. Die Folge setzt sich jahresübergreifend fort, bis eine neuere Folge beginnt."}),e.jsxs("div",{children:[e.jsx("h4",{children:"Schichtfolgenwechsel (gültig ab)"}),e.jsxs("table",{className:f.table,children:[e.jsx("thead",{children:e.jsxs("tr",{className:f.thead,children:[e.jsx("th",{style:{width:180,position:"sticky",top:0,background:"var(--bg)",zIndex:1},children:"Gültig ab (YYYY-MM-DD)"}),e.jsx("th",{children:'Muster (21 Felder, "IW" oder leer)'}),e.jsx("th",{className:f.center,style:{width:60},children:"#"})]})}),e.jsx("tbody",{className:f.tbody,children:(R||[]).map((t,n)=>e.jsxs("tr",{className:[f.row,B===n?f.selected:""].filter(Boolean).join(" "),onClick:()=>Z(i=>i===n?null:n),children:[e.jsx("td",{children:e.jsx("input",{type:"date",value:t.startDate,disabled:!L,onChange:i=>{if(!L)return;const p=i.target.value;W(a=>a.map((o,r)=>r===n?{...o,startDate:p}:o).sort((o,r)=>o.startDate.localeCompare(r.startDate)))}})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:Array.from({length:21}).map((i,p)=>e.jsxs("select",{value:t.pattern[p]||"",disabled:!L,onChange:a=>{if(!L)return;const o=a.target.value==="IW"?"IW":"";W(r=>r.map((c,u)=>{if(u!==n)return c;const g=[...c.pattern];return g[p]=o,{...c,pattern:g}}))},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"IW",children:"IW"})]},p))})}),e.jsx("td",{className:f.center,children:B===n?"✓":""})]},`${t.startDate}_${n}`))})]}),L?e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:async()=>{try{const t=(R||[]).map(n=>({startDate:n.startDate,pattern:(n.pattern||[]).map(i=>i==="IW"?"IW":"").join(",")}));await window.api.setItwPatterns?.(t)}catch{}finally{U(!1),G(null)}},children:"Speichern"}),e.jsx("button",{onClick:()=>{he&&W(he),G(null),U(!1),Z(null)},children:"Abbrechen"})]}):e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:()=>{U(!0),G(JSON.parse(JSON.stringify(R))),W(t=>[...t,{startDate:new Date().toISOString().slice(0,10),pattern:Array(21).fill("")}].sort((n,i)=>n.startDate.localeCompare(i.startDate))),Z(R?.length??0)},children:"Hinzufügen"}),e.jsx("button",{onClick:()=>{U(!0),G(JSON.parse(JSON.stringify(R)))},disabled:(R||[]).length===0,children:"Ändern"}),e.jsx("button",{onClick:()=>{B!=null&&W(t=>t.filter((n,i)=>i!==B)),Z(null)},disabled:B==null,children:"Löschen"})]})]})]}),e.jsxs("div",{style:{marginTop:24,borderTop:"1px solid #eee",paddingTop:12},children:[e.jsx("h3",{children:"Reguläre Schichtfolgen (Abteilungen 1/2/3)"}),e.jsx("p",{style:{marginTop:0,color:"#666"},children:"Pflege hier die 21‑Tage‑Schichtfolgen mit Gültig-ab; Werte sind 1, 2 oder 3."}),e.jsxs("div",{children:[e.jsx("h4",{children:"Schichtfolgenwechsel (gültig ab)"}),e.jsxs("table",{className:f.table,children:[e.jsx("thead",{children:e.jsxs("tr",{className:f.thead,children:[e.jsx("th",{style:{width:180,position:"sticky",top:0,background:"var(--bg)",zIndex:1},children:"Gültig ab (YYYY-MM-DD)"}),e.jsx("th",{children:"Muster (21 Felder, 1/2/3)"}),e.jsx("th",{className:f.center,style:{width:60},children:"#"})]})}),e.jsx("tbody",{className:f.tbody,children:(O||[]).map((t,n)=>e.jsxs("tr",{className:[f.row,M===n?f.selected:""].filter(Boolean).join(" "),onClick:()=>ee(i=>i===n?null:n),children:[e.jsx("td",{children:e.jsx("input",{type:"date",value:t.startDate,disabled:!H,onChange:i=>{if(!H)return;const p=i.target.value;Y(a=>a.map((o,r)=>r===n?{...o,startDate:p}:o).sort((o,r)=>o.startDate.localeCompare(r.startDate)))}})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:Array.from({length:21}).map((i,p)=>e.jsxs("select",{value:t.pattern[p]||"",disabled:!H,onChange:a=>{if(!H)return;const o=["1","2","3"].includes(a.target.value)?a.target.value:"";Y(r=>r.map((c,u)=>{if(u!==n)return c;const g=[...c.pattern];return g[p]=o,{...c,pattern:g}}))},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"})]},p))})}),e.jsx("td",{className:f.center,children:M===n?"✓":""})]},`${t.startDate}_${n}`))})]}),H?e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:async()=>{try{const t=(O||[]).map(n=>({startDate:n.startDate,pattern:(n.pattern||[]).map(i=>i==="1"||i==="2"||i==="3"?i:"").join(",")}));await window.api.setDeptPatterns?.(t)}catch{}finally{Q(!1),X(null)}},children:"Speichern"}),e.jsx("button",{onClick:()=>{pe&&Y(pe),X(null),Q(!1),ee(null)},children:"Abbrechen"})]}):e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:()=>{Q(!0),X(JSON.parse(JSON.stringify(O))),Y(t=>[...t,{startDate:new Date().toISOString().slice(0,10),pattern:Array(21).fill("")}].sort((n,i)=>n.startDate.localeCompare(i.startDate))),ee(O?.length??0)},children:"Hinzufügen"}),e.jsx("button",{onClick:()=>{Q(!0),X(JSON.parse(JSON.stringify(O)))},disabled:(O||[]).length===0,children:"Ändern"}),e.jsx("button",{onClick:()=>{M!=null&&Y(t=>t.filter((n,i)=>i!==M)),ee(null)},disabled:M==null,children:"Löschen"})]})]})]}),e.jsxs("div",{style:{marginTop:24,borderTop:"1px solid #eee",paddingTop:12},children:[e.jsxs("h3",{children:["Feiertage ",l]}),e.jsx("p",{style:{marginTop:0,color:"#666"},children:"An diesen Tagen wird der ITW nicht besetzt (IW entfällt). Du kannst Datum und (optional) Name pflegen."}),e.jsxs("table",{className:f.table,children:[e.jsx("thead",{children:e.jsxs("tr",{className:f.thead,children:[e.jsx("th",{style:{width:160},children:"Datum (YYYY-MM-DD)"}),e.jsx("th",{children:"Name"}),e.jsx("th",{className:f.center,style:{width:60},children:"#"})]})}),e.jsx("tbody",{className:f.tbody,children:_.map((t,n)=>e.jsxs("tr",{className:[f.row,q===n?f.selected:""].filter(Boolean).join(" "),onClick:()=>K(i=>i===n?null:n),children:[e.jsx("td",{children:e.jsx("input",{type:"date",value:t.date,disabled:!V,onChange:i=>{if(!V)return;const p=i.target.value;F(a=>a.map((o,r)=>r===n?{...o,date:p}:o))}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:t.name,disabled:!V,onChange:i=>{if(!V)return;const p=i.target.value;F(a=>a.map((o,r)=>r===n?{...o,name:p}:o))}})}),e.jsx("td",{className:f.center,children:q===n?"✓":""})]},`${t.date}_${n}`))})]}),V?e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:async()=>{try{await window.api.setHolidaysForYear?.(l,_.map(n=>({date:n.date,name:n.name})));const t=await window.api.getHolidaysForYear?.(l);F((t||[]).map(n=>({date:String(n.date),name:String(n.name||"")})))}catch{}finally{te(!1),se(null),K(null)}},children:"Speichern"}),e.jsx("button",{onClick:()=>{ge&&F(ge),se(null),te(!1),K(null)},children:"Abbrechen"})]}):e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:()=>{te(!0),se(JSON.parse(JSON.stringify(_))),F(t=>[...t,{date:`${l}-01-01`,name:""}]),K(_?.length??0)},children:"Hinzufügen"}),e.jsx("button",{onClick:()=>te(!0),disabled:_.length===0,children:"Ändern"}),e.jsx("button",{onClick:()=>{q!=null&&F(t=>t.filter((n,i)=>i!==q)),K(null)},disabled:q==null,children:"Löschen"})]})]}),e.jsxs("div",{style:{marginTop:24,borderTop:"1px solid #eee",paddingTop:12},children:[e.jsx("h3",{children:"Dienstarten"}),m?e.jsx("div",{children:"Lade Dienstarten ..."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:f.table,children:[e.jsx("thead",{children:e.jsxs("tr",{className:f.thead,children:[e.jsx("th",{style:{width:80},children:"Kürzel"}),e.jsx("th",{children:"Beschreibung"}),e.jsx("th",{style:{width:140},children:"Farbe"}),e.jsx("th",{style:{width:220},children:"Auswertung"}),e.jsx("th",{className:f.center,style:{width:60},children:"#"})]})}),e.jsx("tbody",{className:f.tbody,children:k.map(t=>e.jsxs("tr",{className:[f.row,s===t.id?f.selected:""].filter(Boolean).join(" "),onClick:()=>b(n=>n===t.id?null:t.id),children:[e.jsx("td",{children:S?e.jsx("input",{value:t.code,maxLength:4,style:{width:60},onChange:n=>{const i=n.target.value,p=t.code;x(a=>a.map(o=>o.id===t.id?{...o,code:i}:o)),ne(a=>a[i]?a:{...a,[i]:a[p]||"off"}),ie(a=>a[i]?a:{...a,[i]:a[p]||""})}}):t.code}),e.jsx("td",{children:S?e.jsx("input",{value:t.description,onChange:n=>x(i=>i.map(p=>p.id===t.id?{...p,description:n.target.value}:p))}):t.description}),e.jsx("td",{children:S?e.jsx("input",{type:"color",value:A[t.code]&&/^#?[0-9a-fA-F]{6}$/.test(A[t.code])?A[t.code].startsWith("#")?A[t.code]:`#${A[t.code]}`:"#888888",onChange:n=>{const i=n.target.value;ie(p=>({...p,[t.code]:i}))},style:{width:48,height:28,padding:0,border:"1px solid var(--line)",borderRadius:6,background:"transparent"},title:"Farbe für diese Dienstart"}):e.jsx("div",{style:{width:16,height:16,borderRadius:4,border:"1px solid var(--line)",background:A[t.code]||""||"transparent"},title:A[t.code]||"keine Farbe"})}),e.jsx("td",{children:S?e.jsxs("select",{value:J[t.code]||"off",onChange:n=>{const i=n.target.value;ne(p=>({...p,[t.code]:i}))},children:[e.jsx("option",{value:"off",children:"Aus"}),e.jsx("option",{value:"tag",children:"Tag"}),e.jsx("option",{value:"nacht",children:"Nacht"}),e.jsx("option",{value:"24h",children:"24h"}),e.jsx("option",{value:"itw",children:"ITW"})]}):(()=>{switch(J[t.code]||"off"){case"tag":return"Tag";case"nacht":return"Nacht";case"24h":return"24h";case"itw":return"ITW";default:return"Aus"}})()}),e.jsx("td",{className:f.center,children:s===t.id?"✓":""})]},t.id))})]}),S?e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:Te,children:"Speichern"}),e.jsx("button",{onClick:De,children:"Abbrechen"})]}):e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:ke,children:"Hinzufügen"}),e.jsx("button",{onClick:ve,disabled:k.length===0,children:"Ändern"}),e.jsx("button",{onClick:Ie,disabled:s==null,children:"Löschen"})]})]})]}),e.jsxs("div",{style:{marginTop:24,borderTop:"1px solid #eee",paddingTop:12,display:"flex",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:T,style:{marginRight:8},children:"Abbrechen"}),e.jsx("button",{onClick:be,disabled:j,children:j?"Speichern ...":"Speichern"})]}),me&&e.jsx($e,{year:l,progress:ye,onClose:()=>{re(!1),ae(null),le(null)},onImport:t=>{ae(t),Se(t)}}),je&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{backgroundColor:"white",borderRadius:"8px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0,0,0,0.3)"},children:e.jsx(ze,{onImportComplete:Ce,onClose:()=>ue(!1)})})})]})},$e=({year:T,onClose:D,onImport:w,progress:l})=>{const[h,I]=ce.useState(!0),[C,j]=ce.useState([]);return ce.useEffect(()=>{(async()=>{try{const E=await window.api.getPersonnelList(),k=await window.api.getAzubiList(),x=[...E.map(m=>({id:`p_${m.id}`,name:m.name,vorname:m.vorname,isAzubi:!1})),...k.map(m=>({id:`a_${m.id}`,name:m.name,vorname:m.vorname,isAzubi:!0,lehrjahr:m.lehrjahr}))];j(x)}catch(E){console.warn("[YearImportOverlay] Laden fehlgeschlagen",E)}I(!1)})()},[]),e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},children:h?e.jsx("div",{style:{background:"#fff",padding:32,borderRadius:8},children:"Lade Personen & Azubis ..."}):l?e.jsxs("div",{style:{background:"#fff",padding:32,borderRadius:8,minWidth:340},children:[e.jsx("h3",{style:{marginTop:0},children:"Importiere Jahresdaten ..."}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{style:{height:18,background:"#eee",borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.max(0,Math.min(100,l.total?l.processed/l.total*100:0)).toFixed(1)}%`,background:"#1976d2",height:"100%",transition:"width 0.2s"}})}),e.jsxs("div",{style:{marginTop:8,fontSize:13,color:"#444"},children:[l.processed," / ",l.total," Einträge"]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx("button",{onClick:D,children:"Schließen"})})]}):e.jsx(Fe,{year:T,personnel:C,onCancel:D,onImport:w})})};export{Ye as S};
